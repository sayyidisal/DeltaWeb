{"version":3,"sources":["minislate.js"],"names":["e","exports","module","define","amd","f","window","global","self","Minislate","t","n","r","s","o","u","a","require","i","Error","call","length",1,"_dereq_","_util","Class","extend","ControlsMixin","Object","init","this","controls","addControl","klass","id","options","removeControl","BaseControl","defaults","label","title","classes","fontAwesomeID","toolbar","element","_initElement","setLabel","setAttribute","push","apply","split","classList","add","_getClassName","addEventListener","setVisibility","setHighlight","drawElement","document","createElement","appendChild","firstChild","removeChild","text","createTextNode","fontAwesomeEnabled","fa","getFaElement","span","isHighlighted","isVisible","state","parentNode","style","display","cls","contains","remove","el","Button","prototype","evt","click","_getParentElement","Menu","closeDelay","_klass","_id","_options","container","openHandler","_open","closeHandler","_closetimer","cancelHandler","_canceltimer","_close","removeEventListener","setTimeout","control","closeTimeout","clearTimeout","drawControls","Klass","_dirty","Dialog","dialog","addTextField","size","enter","escape","input","_label","which","addButton","button","./util",2,"_controls","rangy","api","_","Block","tagList","tag","command","arguments","BLOCK_NODES","filter","editor","v","indexOf","toLowerCase","filterTopNodeNames","topNodes","setRange","exec","showToolbar","Paragraph","C","Preformated","tabReplacement","on","ctrlKey","metaKey","shiftKey","preventDefault","node","getEnclosingNode","nodeList","slice","getElementsByTagName","each","insertBefore","BaseList","nodeName","topListNodes","selection","saveSelection","childNodes","restoreSelection","removeMarkers","UnorderedList","OrderedList","Blockquote","getSelection","isCollapsed","parent","previousSibling","textContent","nextSibling","collapse","removeBlockquote","insertBlockquote","getTopNodes","surroundingBlocks","getSurroundingNodes","toUpperCase","dom","replaceNodeByContents","../../vendor/rangy/core","../controls","../util",3,"Inline","Bold","Italic","Underline","StrikeThrough","LinkDialog","show","showDialog","focus","saveLink","target","value","stopImmediatePropagation","getAttribute","Link","base_title","nodes","href","collapsed","url","range","getRange","contents","cloneContents","cloneNode","deleteContents","insertNode",4,"ImageDialog","saveImage","Image","tagName","cleanBlock",5,"Toolbar","HtmlCleaner","Editor","delay","diffLeft","diffTop","classPrefix","initialized","isActive","isSelected","_currentEditor","_resizeHandler","timeout","setToolbarPosition","initElement","initToolbar","bindSelect","bindTyping","name","handler","off","_onFocus","wrapper","_onSelect","elements","querySelectorAll","cmd","arg","execCommand","hideDialog","hideToolbar","hide","callback","boundary","height","offsetHeight","width","offsetWidth","util","isHostMethod","nativeRange","getBoundingClientRect","top","bottom","pageYOffset","left","right","move","hasParents","selectStart","nodeType","replace","getNodes","createRange","setStart","setSingleRange","index","getRangeAt","end","selectNodeContents","lastChild","setEndAfter","rangeCount","names","map","serialize","clean","html","innerHTML","cleaner","inline","block","media","simpleEditor","H1","H2","H3","Oembed","../vendor/rangy/core","./controls","./controls/block","./controls/inline","./controls/media","./html-cleaner","./toolbar",6,"formatRegexp","cleanRegexp","removeFormat","tagsoup2html","test","m0","m1","m2","reg","_f","m3","_r",7,"createCoreModule","selectionPrototype","getBoundaryNodes","startNode","startOffset","endNode","endOffset","isBackwards","focusNode","focusOffset","anchorNode","anchorOffset","start","getCommonAncestor","getDeepestNode","body","result","started","isAncestorOf","parents","content","getDocument","createDocumentFragment","replaceChild","inloop",8,"visibility","_showEvt","createEvent","initEvent","_hideEvt","fn","dispatchEvent","emptyDialog",9,"args","Array","base","shift","type","c","prop","proto","F","constructor","breaker","nativeForEach","forEach","nativeMap","nativeFilter","obj","iterator","context","keys","results","list","predicate",10,"VERSION","./lib/editor","./lib/html-cleaner","./lib/rangy-extensions","./lib/util","./vendor/rangy/core","./vendor/rangy/dom","./vendor/rangy/domrange","./vendor/rangy/selectionsaverestore","./vendor/rangy/wrappedrange","./vendor/rangy/wrappedselection",11,"p","FUNCTION","OBJECT","isHostObject","isHostProperty","UNDEFINED","createMultiplePropertyTest","testFunc","props","isTextRange","areHostMethods","textRangeMethods","areHostProperties","textRangeProperties","getBody","doc","consoleLog","msg","console","log","alertOrLog","shouldAlert","alert","fail","reason","supported","config","alertOnFail","warn","alertOnWarn","getErrorDesc","ex","message","description","String","testRange","implementsDomRange","implementsTextRange","domRangeMethods","domRangeProperties","detach","createTextRange","features","errorMessage","moduleName","modules","Module","len","initListeners","createMissingNativeApi","win","createMissingNativeApiListeners","dependencies","initializer","createModule","isCore","initFunc","newModule","RangePrototype","SelectionPrototype","areHostObjects","version","preferTextRange","hasOwnProperty","deep","toArray","arrayLike","arr","addListener","eventType","listener","attachEvent","addInitListener","addCreateMissingNativeApiListener","requiredModule","requiredModuleNames","deprecationNotice","deprecated","replacement","createError","rangePrototype",12,"isHtmlNamespace","ns","namespaceURI","UNDEF","parentElement","getNodeIndex","getNodeLength","node1","node2","ancestors","arrayContains","ancestor","descendant","selfIsAncestor","isOrIsAncestorOf","getClosestAncestorIn","isCharacterDataNode","isTextOrCommentNode","insertAfter","precedingNode","nextNode","splitDataNode","positionsToPreserve","newNode","deleteData","position","offset","ownerDocument","getWindow","defaultView","parentWindow","getIframeDocument","iframeEl","contentDocument","contentWindow","getIframeWindow","isWindow","getContentDocument","methodName","getRootContainer","comparePoints","nodeA","offsetA","nodeB","offsetB","nodeC","root","childA","childB","isBrokenNode","inspectNode","crashyTextNodes","data","idAttr","fragmentFromNodeChildren","child","fragment","NodeIterator","_next","createIterator","DomPosition","DOMException","codeName","code","textNode","val","getComputedStyleProperty","getComputedStyle","propName","documentElement","currentStyle","_current","hasNext","next","equals","pos","inspect","toString","INDEX_SIZE_ERR","HIERARCHY_REQUEST_ERR","WRONG_DOCUMENT_ERR","NO_MODIFICATION_ALLOWED_ERR","NOT_FOUND_ERR","NOT_SUPPORTED_ERR","INVALID_STATE_ERR","./core",13,"isNonTextPartiallySelected","startContainer","endContainer","getRangeDocument","getBoundaryBeforeNode","getBoundaryAfterNode","insertNodeAtPosition","firstNodeInserted","rangesIntersect","rangeA","rangeB","touchingIsIntersecting","assertRangeValid","startComparison","endComparison","cloneSubtree","partiallySelected","subIterator","frag","isPartiallySelectedSubtree","getSubtreeIterator","iterateSubtree","rangeIterator","func","iteratorState","it","stop","subRangeIterator","deleteSubtree","extractSubtree","getNodesInRange","nodeTypes","regex","filterNodeTypes","filterExists","RegExp","join","RangeIterator","sc","ec","getName","clonePartiallySelectedTextNodes","so","eo","commonAncestorContainer","isSingleCharacterDataNode","_first","_last","RangeException","createAncestorFinder","assertNoDocTypeNotationEntityAncestor","allowSelf","getDocTypeNotationEntityAncestor","assertNotDetached","assertValidNodeType","invalidTypes","assertValidOffset","assertSameDocumentOrFragment","getDocumentOrFragmentContainer","assertNodeNotReadOnly","getReadonlyAncestor","assertNode","isOrphan","rootContainerNodeTypes","isValidOffset","isRangeValid","splitRangeBoundaries","startEndSame","setStartAndEnd","copyComparisonConstantsToObject","START_TO_START","s2s","START_TO_END","s2e","END_TO_END","e2e","END_TO_START","e2s","NODE_BEFORE","n_b","NODE_AFTER","n_a","NODE_BEFORE_AND_AFTER","n_b_a","NODE_INSIDE","n_i","copyComparisonConstants","createRangeContentRemover","remover","boundaryUpdater","reset","returnValue","createPrototypeRange","detacher","createBeforeAfterNodeSetter","isBefore","isStart","beforeAfterNodeTypes","setRangeStart","setRangeEnd","setEnd","setBoundary","setStartBefore","setStartAfter","setEndBefore","selectNode","extractContents","canSurroundContents","boundariesInvalid","splitBoundaries","splitBoundariesPreservingPositions","normalizeBoundaries","mergeForward","sibling","appendData","mergeBackward","nodeLength","insertData","nodeIndex","normalizeStart","collapseToPoint","updateCollapsedAndCommonAncestor","updateBoundaries","Range","current","subRange","cloneRange","detachRange","BAD_BOUNDARYPOINTS_ERR","INVALID_NODE_TYPE_ERR","readonlyNodeTypes","insertableNodeTypes","surroundNodeTypes","styleEl","htmlParsingConforms","createContextualFragment","fragmentStr","rangeProperties","compareBoundaryPoints","how","prefixA","prefixB","clone","surroundContents","hasChildNodes","textParts","compareNode","comparePoint","toHtml","intersectsNode","isPointInRange","intersectsRange","intersectsOrTouchesRange","intersection","intersectionRange","union","unionRange","containsNode","allowPartial","containsNodeContents","containsRange","containsNodeText","nodeRange","textNodes","lastTextNode","pop","collapseBefore","collapseAfter","getBookmark","containerNode","preSelectionRange","moveToBookmark","bookmark","charIndex","nextCharIndex","nodeStack","foundStart","rangesEqual","isValid","r1","r2","DomRange",14,"gEBI","getElementById","insertRangeBoundaryMarker","atStart","markerEl","markerId","Date","Math","random","boundaryRange","lineHeight","className","markerTextChar","setRangeBoundary","compareRanges","saveRange","backward","startEl","endEl","startMarkerId","endMarkerId","restoreRange","rangeInfo","normalize","previousNode","saveRanges","ranges","rangeInfos","sort","isSelectionValid","sel","getAllRanges","isBackward","setRanges","restored","restoreRanges","savedSelection","preserveDirection","selectionHasExtend","removeAllRanges","addRange","removeMarkerElement",15,"WrappedRange","WrappedTextRange","updateRangeProperties","updateNativeRange","startMoved","endMoved","nativeRangeDifferent","detached","rangeProto","refresh","testTextNode","oppositeName","range2","createNativeRange","getTextRangeContainerElement","textRange","parentEl","duplicate","startEndContainer","textRangeIsCollapsed","compareEndPoints","getTextRangeBoundaryPosition","wholeRangeContainerElement","startInfo","workingRange","containerElement","canHaveHTML","boundaryPosition","nodeInfo","workingNode","comparison","boundaryNode","workingComparisonType","childNodeCount","moveToElementText","floor","setEndPoint","tempRange","rangeLength","moveStart","createBoundaryTextRange","boundaryParent","boundaryOffset","nodeIsDataNode","startBoundary","rangeContainerElement","rangeToTextRange","startRange","endRange","globalObj","createRangyRange","createIframeRange","createIframeRangyRange",16,"isDirectionBackward","dir","WrappedSelection","getWinSelection","winParam","getDocSelection","winSelectionIsBackward","updateAnchorAndFocusFromRange","anchorPrefix","focusPrefix","updateAnchorAndFocusFromNativeSelection","nativeSel","nativeSelection","updateEmptySelection","_ranges","getNativeRange","rangeContainsSingleElement","rangeNodes","getSingleElementFromRange","updateFromTextRange","wrappedRange","updateControlSelection","docSelection","controlRange","item","addRangeToControlSelection","rangeElement","newControlRange","createControlRange","select","deleteProperties","actOnCachedSelection","action","cached","cachedRangySelections","splice","createControlSelection","assertNodeInSameDocument","createStartOrEndSetter","rangeInspects","anchor","checkSelectionRanges","getNativeSelection","selectionIsCollapsed","BOOLEAN","NUMBER","CONTROL","implementsWinGetSelection","implementsDocSelection","useDocumentSelection","testSelection","selectionHasAnchorAndFocus","selectionHasRangeCount","selectionSupportsMultipleRanges","collapsedNonEditableSelectionsSupported","addRangeBackwardToNative","originalSelectionRangeCount","selectionHasMultipleRanges","originalSelectionRanges","originalSelectionBackward","testEl","contentEditable","testControlRange","implementsControlRange","getSelectionRangeAt","docSel","getIframeSelection","selProto","addRangeBackward","direction","previousRangeCount","selectionIsBackward","empty","refreshSelection","checkForChanges","oldRanges","oldAnchorNode","oldAnchorOffset","removeRangeManually","removeRange","removed","rangeTexts","collapseToStart","collapseToEnd","selectAllChildren","deleteFromDocument","eachRange","callMethodOnEachRange","params","changeEachRange","rangeBookmarks","rangeBookmark","selRanges","detachAll","Selection"],"mappings":"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","file":"minislate.min.js","sourcesContent":["/*!\n * Minislate\n * Version: 0.3.0\n *\n * Includes Rangy\n * https://code.google.com/p/rangy/\n *\n * Copyright 2014, Olivier Meunier and contributors\n * Released under the MIT license\n *\n * Date: 2014-11-28T10:22:56Z\n */\n!function(e) {\n    if (\"object\" == typeof exports && \"undefined\" != typeof module) module.exports = e(); else if (\"function\" == typeof define && define.amd) define([], e); else {\n        var f;\n        \"undefined\" != typeof window ? f = window : \"undefined\" != typeof global ? f = global : \"undefined\" != typeof self && (f = self), \n        f.Minislate = e();\n    }\n}(function() {\n    var define, module, exports;\n    return function e(t, n, r) {\n        function s(o, u) {\n            if (!n[o]) {\n                if (!t[o]) {\n                    var a = typeof require == \"function\" && require;\n                    if (!u && a) return a(o, !0);\n                    if (i) return i(o, !0);\n                    throw new Error(\"Cannot find module '\" + o + \"'\");\n                }\n                var f = n[o] = {\n                    exports: {}\n                };\n                t[o][0].call(f.exports, function(e) {\n                    var n = t[o][1][e];\n                    return s(n ? n : e);\n                }, f, f.exports, e, t, n, r);\n            }\n            return n[o].exports;\n        }\n        var i = typeof require == \"function\" && require;\n        for (var o = 0; o < r.length; o++) s(r[o]);\n        return s;\n    }({\n        1: [ function(_dereq_, module, exports) {\n            var _util = _dereq_(\"./util\"), Class = _util.Class, extend = _util.extend;\n            var ControlsMixin = Class(Object, {\n                init: function() {\n                    this.controls = {};\n                },\n                addControl: function(klass, id, options) {\n                    throw new Error(\"Not implemented\");\n                },\n                removeControl: function(id) {\n                    if (!this.controls[id]) {\n                        return;\n                    }\n                    delete this.controls[id];\n                }\n            });\n            var BaseControl = Class(Object, {\n                defaults: {\n                    label: null,\n                    title: \"\",\n                    classes: \"\",\n                    fontAwesomeID: null\n                },\n                classes: [],\n                init: function(toolbar, id, options) {\n                    this.options = extend({}, this.defaults, options || {});\n                    this.toolbar = toolbar;\n                    this.id = id;\n                    this.label = this.options.label || this.id;\n                    this.element = this._initElement();\n                    this.setLabel();\n                    this.element.setAttribute(\"title\", this.options.title);\n                    if (this.options.classes) {\n                        this.classes.push.apply(this.classes, this.options.classes.split(/\\s+/));\n                    }\n                    for (var i = 0; i < this.classes.length; i++) {\n                        this.element.classList.add(this.toolbar._getClassName(this.classes[i]));\n                    }\n                    var self = this;\n                    this.toolbar.element.addEventListener(\"toolbar.show\", function() {\n                        self.setVisibility();\n                        self.setHighlight();\n                    });\n                },\n                _initElement: function() {\n                    throw new Error(\"_initElement not implemented\");\n                },\n                drawElement: function(e) {\n                    e = e || document.createElement(\"li\");\n                    e.appendChild(this.element);\n                    return e;\n                },\n                setLabel: function(label, fontAwesomeID) {\n                    label = label || this.label;\n                    fontAwesomeID = fontAwesomeID || this.options.fontAwesomeID;\n                    while (this.element.firstChild) {\n                        this.element.removeChild(this.element.firstChild);\n                    }\n                    var text = document.createTextNode(label);\n                    if (this.toolbar.options.fontAwesomeEnabled && fontAwesomeID) {\n                        var fa = this.getFaElement(fontAwesomeID);\n                        var span = document.createElement(\"span\");\n                        span.appendChild(text);\n                        fa.appendChild(span);\n                        this.element.appendChild(fa);\n                    } else {\n                        this.element.appendChild(text);\n                    }\n                },\n                isHighlighted: function() {\n                    return false;\n                },\n                isVisible: function() {\n                    return true;\n                },\n                setVisibility: function(state) {\n                    state = typeof state !== \"undefined\" ? state : this.isVisible();\n                    if (state) {\n                        this.element.parentNode.style.display = \"block\";\n                    } else {\n                        this.element.parentNode.style.display = \"none\";\n                    }\n                },\n                setHighlight: function(state) {\n                    state = typeof state !== \"undefined\" ? state : this.isHighlighted();\n                    var cls = this.toolbar._getClassName(\"highlight\");\n                    if (state) {\n                        if (!this.element.classList.contains(cls)) {\n                            this.element.classList.add(cls);\n                        }\n                    } else {\n                        this.element.classList.remove(cls);\n                    }\n                },\n                getFaElement: function(id) {\n                    var el = document.createElement(\"i\");\n                    el.classList.add(\"fa\", \"fa-\" + id);\n                    return el;\n                }\n            });\n            var Button = Class(BaseControl, {\n                classes: [ \"button\" ],\n                init: function(toolbar, id, options) {\n                    BaseControl.prototype.init.call(this, toolbar, id, options);\n                    var self = this;\n                    this.element.addEventListener(\"click\", function(evt) {\n                        self.click(evt);\n                    });\n                },\n                _getParentElement: function() {\n                    var e = BaseControl.prototype._getParentElement.call(this);\n                    e.classList.add(this.toolbar._getClassName(\"button\"));\n                    return e;\n                },\n                _initElement: function() {\n                    return document.createElement(\"button\");\n                },\n                drawElement: function() {\n                    var e = document.createElement(\"li\");\n                    e.classList.add(this.toolbar._getClassName(\"button\"));\n                    return BaseControl.prototype.drawElement.call(this, e);\n                },\n                click: function() {}\n            });\n            var Menu = Class(BaseControl, {\n                defaults: extend({}, BaseControl.prototype.defaults, {\n                    controls: []\n                }),\n                classes: [ \"button\" ],\n                closeDelay: 400,\n                init: function(toolbar, id, options) {\n                    ControlsMixin.prototype.init.call(this);\n                    BaseControl.prototype.init.call(this, toolbar, id, options);\n                    var _klass, _id, _options;\n                    for (var i = 0; i < this.options.controls.length; i++) {\n                        _klass = this.options.controls[i][0];\n                        _id = this.options.controls[i][1];\n                        _options = this.options.controls[i][2];\n                        this.addControl(_klass, _id, _options);\n                    }\n                    this.container = document.createElement(\"ul\");\n                    this.container.classList.add(this.toolbar._getClassName(\"controls\"));\n                    this.container.style.display = \"none\";\n                    var self = this;\n                    var openHandler = function() {\n                        self._open();\n                    };\n                    var closeHandler = function() {\n                        self._closetimer();\n                    };\n                    var cancelHandler = function() {\n                        self._canceltimer();\n                    };\n                    this.toolbar.element.addEventListener(\"toolbar.show\", function() {\n                        self._close();\n                        self.element.removeEventListener(\"mouseover\", openHandler);\n                        self.element.removeEventListener(\"mouseout\", closeHandler);\n                        self.container.removeEventListener(\"mouseover\", cancelHandler);\n                        self.container.removeEventListener(\"mouseout\", closeHandler);\n                        setTimeout(function() {\n                            self.element.addEventListener(\"mouseover\", openHandler);\n                            self.element.addEventListener(\"mouseout\", closeHandler);\n                            self.container.addEventListener(\"mouseover\", cancelHandler);\n                            self.container.addEventListener(\"mouseout\", closeHandler);\n                        }, 200);\n                    });\n                },\n                _open: function() {\n                    var control, i;\n                    for (i in this.toolbar.controls) {\n                        control = this.toolbar.controls[i];\n                        if (control instanceof Menu) {\n                            control._canceltimer();\n                            control._close();\n                        }\n                    }\n                    this._canceltimer();\n                    this.container.style.display = \"block\";\n                },\n                _close: function() {\n                    this.container.style.display = \"none\";\n                },\n                _closetimer: function() {\n                    var self = this;\n                    this.closeTimeout = setTimeout(function() {\n                        self._close();\n                    }, this.closeDelay);\n                },\n                _canceltimer: function() {\n                    if (this.closeTimeout) {\n                        clearTimeout(this.closeTimeout);\n                        this.closeTimeout = null;\n                    }\n                },\n                _initElement: function() {\n                    return document.createElement(\"button\");\n                },\n                isHighlighted: function() {\n                    var control, id;\n                    for (id in this.controls) {\n                        control = this.controls[id];\n                        if (control.id, control.isHighlighted()) {\n                            this.setLabel(control.label, control.options.fontAwesomeID);\n                            return true;\n                        }\n                    }\n                    return false;\n                },\n                drawElement: function() {\n                    var e = document.createElement(\"li\");\n                    e.classList.add(this.toolbar._getClassName(\"menu\"));\n                    e = BaseControl.prototype.drawElement.call(this, e);\n                    e.appendChild(this.container);\n                    this.drawControls();\n                    return e;\n                },\n                setLabel: function(label, fontAwesomeID) {\n                    BaseControl.prototype.setLabel.call(this, label, fontAwesomeID);\n                    this.element.appendChild(document.createTextNode(\" \"));\n                    var e;\n                    if (this.toolbar.options.fontAwesomeEnabled) {\n                        e = this.getFaElement(\"chevron-down\");\n                    } else {\n                        e = document.createElement(\"span\");\n                        e.classList.add(this.toolbar._getClassName(\"menu-arrow\"));\n                        e.appendChild(document.createTextNode(\"\"));\n                    }\n                    this.element.appendChild(e);\n                },\n                addControl: function(Klass, id, options) {\n                    this.controls[id] = new Klass(this.toolbar, id, options);\n                    this.toolbar._dirty = true;\n                },\n                removeControl: function(id) {\n                    if (!this.controls[id]) {\n                        return;\n                    }\n                    ControlsMixin.prototype.removeControl.call(this, id);\n                    this.toolbar._dirty = true;\n                },\n                drawControls: function() {\n                    var control, id, e;\n                    while (this.container.firstChild) {\n                        this.container.removeChild(this.container.firstChild);\n                    }\n                    for (id in this.controls) {\n                        control = this.controls[id];\n                        e = control.drawElement();\n                        control.setLabel();\n                        this.container.appendChild(e);\n                        if (control.options.title) {\n                            var el = document.createElement(\"em\");\n                            var text = document.createTextNode(\" - \" + control.options.title);\n                            el.appendChild(text);\n                            e.firstChild.appendChild(el);\n                        }\n                    }\n                }\n            });\n            var Dialog = Class(Object, {\n                init: function(control) {\n                    this.control = control;\n                    this.toolbar = control.toolbar;\n                    this.element = control.toolbar.dialog;\n                },\n                addTextField: function(label, options) {\n                    var defaults = {\n                        size: 30,\n                        enter: null,\n                        escape: null\n                    };\n                    options = extend({}, defaults, options || {});\n                    var input = document.createElement(\"input\");\n                    var _label = document.createElement(\"label\");\n                    _label.appendChild(document.createTextNode(label));\n                    input.setAttribute(\"size\", options.size);\n                    input.setAttribute(\"type\", \"text\");\n                    _label.appendChild(input);\n                    this.element.appendChild(_label);\n                    if (options.enter || options.escape) {\n                        input.addEventListener(\"keyup\", function(evt) {\n                            if (options.escape && evt.which === 27) {\n                                options.escape.call(input, evt);\n                            } else if (options.enter && evt.which === 13) {\n                                options.enter.call(input, evt);\n                            }\n                        });\n                    }\n                    return input;\n                },\n                addButton: function(label, options) {\n                    var defaults = {\n                        click: null,\n                        fontAwesomeID: null\n                    };\n                    options = extend({}, defaults, options || {});\n                    var button = document.createElement(\"button\");\n                    button.appendChild(document.createTextNode(label));\n                    this.element.appendChild(document.createTextNode(\" \"));\n                    this.element.appendChild(button);\n                    this.element.appendChild(document.createTextNode(\" \"));\n                    if (options.click && typeof options.click === \"function\") {\n                        button.addEventListener(\"click\", options.click);\n                    }\n                    if (options.fontAwesomeID && this.toolbar.options.fontAwesomeEnabled) {\n                        button.removeChild(button.firstChild);\n                        button.setAttribute(\"title\", label);\n                        var el = BaseControl.prototype.getFaElement.call(null, options.fontAwesomeID);\n                        button.appendChild(el);\n                    }\n                    return button;\n                }\n            });\n            exports.ControlsMixin = ControlsMixin;\n            exports.BaseControl = BaseControl;\n            exports.Button = Button;\n            exports.Menu = Menu;\n            exports.Dialog = Dialog;\n        }, {\n            \"./util\": 9\n        } ],\n        2: [ function(_dereq_, module, exports) {\n            var _util = _dereq_(\"../util\"), _controls = _dereq_(\"../controls\"), rangy = _dereq_(\"../../vendor/rangy/core\").api, Class = _util.Class, extend = _util.extend, _ = _util._, Button = _controls.Button;\n            var Block = Class(Button, {\n                tagList: [],\n                tag: null,\n                command: \"formatblock\",\n                defaults: extend({}, Button.prototype.defaults),\n                init: function() {\n                    Button.prototype.init.apply(this, arguments);\n                    this.BLOCK_NODES = _.filter(this.toolbar.editor.BLOCK_NODES, function(v) {\n                        return [ \"ul\", \"ol\" ].indexOf(v.toLowerCase()) === -1;\n                    });\n                },\n                isHighlighted: function() {\n                    return this.toolbar.editor.filterTopNodeNames.apply(this.toolbar.editor, this.tagList).length > 0;\n                },\n                click: function() {\n                    var editor = this.toolbar.editor, topNodes;\n                    if (this.command === \"formatblock\") {\n                        if (!this.isHighlighted()) {\n                            topNodes = editor.filterTopNodeNames.apply(editor, this.BLOCK_NODES);\n                            if (topNodes.length > 0) {\n                                editor.setRange(topNodes[0]);\n                            }\n                        }\n                        this.toolbar.editor.exec(this.command, \"<\" + this.tag + \">\");\n                    } else {\n                        this.toolbar.editor.exec(this.command);\n                    }\n                    this.toolbar.editor.showToolbar();\n                }\n            });\n            exports.Block = Block;\n            exports.Paragraph = Class(Block, {\n                tagList: [ \"p\" ],\n                tag: \"p\",\n                command: \"formatblock\",\n                defaults: extend({}, Block.prototype.defaults, {\n                    label: \"\",\n                    title: \"Paragraph\"\n                })\n            });\n            for (var i = 1; i <= 6; i++) {\n                var C = Class(Block, {\n                    tagList: [ \"h\" + i ],\n                    tag: \"h\" + i,\n                    defaults: extend({}, Block.prototype.defaults, {\n                        label: \"H\" + i,\n                        title: \"Title level \" + i\n                    })\n                });\n                exports[\"H\" + i] = C;\n            }\n            exports.Preformated = Class(Block, {\n                tagList: [ \"pre\" ],\n                tag: \"pre\",\n                defaults: extend({}, Block.prototype.defaults, {\n                    label: \"<>\",\n                    title: \"Code\",\n                    fontAwesomeID: \"code\",\n                    tabReplacement: \"    \"\n                }),\n                init: function() {\n                    Block.prototype.init.apply(this, arguments);\n                    var self = this, editor = this.toolbar.editor;\n                    editor.on(\"keydown\", function(evt) {\n                        if (evt.which === 9 && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey) {\n                            if (editor.filterTopNodeNames(\"pre\").length > 0) {\n                                evt.preventDefault();\n                                editor.exec(\"insertHtml\", self.options.tabReplacement);\n                            }\n                        }\n                    });\n                },\n                click: function() {\n                    Block.prototype.click.call(this);\n                    var editor = this.toolbar.editor, node = editor.getEnclosingNode(), nodeList = [].slice.call(node.getElementsByTagName(\"br\"));\n                    _.each(nodeList, function(n) {\n                        n.parentNode.insertBefore(document.createTextNode(\"\\n\"), n);\n                        n.parentNode.removeChild(n);\n                    });\n                }\n            });\n            var BaseList = Class(Block, {\n                init: function() {\n                    Block.prototype.init.apply(this, arguments);\n                    var self = this, editor = this.toolbar.editor;\n                    editor.on(\"keydown\", function(evt) {\n                        if (evt.which === 9 && !evt.ctrlKey && !evt.metaKey) {\n                            var topNodes = editor.filterTopNodeNames(\"ul\", \"ol\");\n                            if (topNodes.length === 0 || topNodes[0].nodeName.toLowerCase() !== self.tag) {\n                                return;\n                            }\n                            evt.preventDefault();\n                            if (evt.shiftKey) {\n                                editor.exec(\"outdent\");\n                            } else {\n                                editor.exec(\"indent\");\n                            }\n                        }\n                    });\n                },\n                click: function() {\n                    var editor = this.toolbar.editor, topListNodes = editor.filterTopNodeNames(\"ul\", \"ol\");\n                    if (topListNodes.length > 0) {\n                        if (topListNodes[0].nodeName.toLowerCase() === this.tag) {\n                            return;\n                        }\n                        var node = topListNodes[0], selection = rangy.saveSelection(), e = document.createElement(this.tag);\n                        node.parentNode.insertBefore(e, node);\n                        _.each([].slice.call(node.childNodes), function(n) {\n                            e.appendChild(n);\n                        });\n                        node.parentNode.removeChild(node);\n                        rangy.restoreSelection(selection);\n                        rangy.removeMarkers(selection);\n                        editor.showToolbar();\n                    } else {\n                        Block.prototype.click.call(this);\n                    }\n                }\n            });\n            exports.UnorderedList = Class(BaseList, {\n                tagList: [ \"ul\" ],\n                tag: \"ul\",\n                command: \"insertunorderedlist\",\n                defaults: extend({}, BaseList.prototype.defaults, {\n                    label: \"UL\",\n                    title: \"Unordered list\",\n                    fontAwesomeID: \"list-ul\"\n                })\n            });\n            exports.OrderedList = Class(BaseList, {\n                tagList: [ \"ol\" ],\n                tag: \"ol\",\n                command: \"insertorderedlist\",\n                defaults: extend({}, BaseList.prototype.defaults, {\n                    label: \"OL\",\n                    title: \"Ordered list\",\n                    fontAwesomeID: \"list-ol\"\n                })\n            });\n            exports.Blockquote = Class(Block, {\n                tagList: [ \"blockquote\" ],\n                defaults: extend({}, Block.prototype.defaults, {\n                    label: \"Quote\",\n                    title: \"Quote\",\n                    fontAwesomeID: \"quote-right\"\n                }),\n                init: function() {\n                    Block.prototype.init.apply(this, arguments);\n                    var self = this, editor = this.toolbar.editor;\n                    editor.on(\"keyup\", function(evt) {\n                        if (evt.which === 13 && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey) {\n                            var node = editor.filterTopNodeNames(\"blockquote\");\n                            if (node.length === 0 || !editor.getSelection().isCollapsed) {\n                                return;\n                            }\n                            var parent = node[0];\n                            node = editor.filterTopNodeNames(\"p\");\n                            if (node.length === 0) {\n                                return;\n                            }\n                            node = node[0];\n                            if (node.previousSibling && node.previousSibling.textContent === \"\") {\n                                node.previousSibling.parentNode.removeChild(node.previousSibling);\n                                parent.parentNode.insertBefore(node, parent.nextSibling);\n                                editor.setRange(node);\n                                editor.getSelection().collapse(node);\n                            }\n                        }\n                    });\n                    editor.on(\"keydown\", function(evt) {\n                        if (evt.which === 9 && !evt.ctrlKey && !evt.metaKey) {\n                            var node = editor.filterTopNodeNames(\"blockquote\");\n                            if (node.length === 0) {\n                                return;\n                            }\n                            evt.preventDefault();\n                            if (evt.shiftKey) {\n                                self.removeBlockquote();\n                            } else {\n                                self.insertBlockquote();\n                            }\n                        }\n                    });\n                },\n                click: function() {\n                    var editor = this.toolbar.editor, selection = editor.getSelection();\n                    if (selection.isCollapsed && editor.getTopNodes().length === 0) {\n                        return;\n                    }\n                    if (editor.filterTopNodeNames(\"blockquote\").length > 0) {\n                        this.removeBlockquote();\n                    } else {\n                        this.insertBlockquote();\n                    }\n                    editor.showToolbar();\n                },\n                insertBlockquote: function() {\n                    var editor = this.toolbar.editor, nodeList = editor.filterTopNodeNames.apply(editor, editor.BLOCK_NODES), node = nodeList.length > 0 ? nodeList[0] : null, surroundingBlocks = editor.getSurroundingNodes(function(n) {\n                        return editor.BLOCK_NODES.indexOf(n.nodeName.toUpperCase()) !== -1;\n                    });\n                    if (surroundingBlocks.length > 0) {\n                        nodeList = surroundingBlocks;\n                    } else if (node) {\n                        nodeList = [ node ];\n                    } else {\n                        nodeList = editor.getSurroundingNodes();\n                    }\n                    editor.setRange(nodeList[0], nodeList[nodeList.length - 1]);\n                    nodeList = editor.getSurroundingNodes();\n                    var e = document.createElement(\"blockquote\");\n                    nodeList[0].parentNode.insertBefore(e, nodeList[0]);\n                    _.each(nodeList, e.appendChild, e);\n                    editor.setRange(e);\n                },\n                removeBlockquote: function() {\n                    var nodeList = this.toolbar.editor.filterTopNodeNames(\"blockquote\"), selection = rangy.saveSelection();\n                    rangy.dom.replaceNodeByContents(nodeList[0]);\n                    rangy.restoreSelection(selection);\n                    rangy.removeMarkers(selection);\n                }\n            });\n        }, {\n            \"../../vendor/rangy/core\": 11,\n            \"../controls\": 1,\n            \"../util\": 9\n        } ],\n        3: [ function(_dereq_, module, exports) {\n            var _util = _dereq_(\"../util\"), _controls = _dereq_(\"../controls\"), rangy = _dereq_(\"../../vendor/rangy/core\").api, Class = _util.Class, extend = _util.extend, _ = _util._, Button = _controls.Button, Dialog = _controls.Dialog;\n            var Inline = Class(Button, {\n                tagList: [],\n                command: null,\n                isHighlighted: function() {\n                    return this.toolbar.editor.filterTopNodeNames.apply(this.toolbar.editor, this.tagList).length > 0;\n                },\n                isVisible: function() {\n                    return !this.toolbar.editor.getSelection().isCollapsed || this.isHighlighted();\n                },\n                click: function() {\n                    var editor = this.toolbar.editor;\n                    if (editor.getSelection().isCollapsed) {\n                        var node = editor.filterTopNodeNames.apply(editor, this.tagList);\n                        if (node.length === 0) {\n                            return;\n                        }\n                        node = node[0];\n                        editor.setRange(node);\n                    }\n                    editor.exec(this.command);\n                    editor.showToolbar();\n                }\n            });\n            exports.Inline = Inline;\n            exports.Bold = Class(Inline, {\n                defaults: extend({}, Inline.prototype.defaults, {\n                    label: \"B\",\n                    title: \"Bold\",\n                    fontAwesomeID: \"bold\"\n                }),\n                tagList: [ \"b\", \"strong\" ],\n                command: \"bold\",\n                init: function() {\n                    Inline.prototype.init.apply(this, arguments);\n                    var self = this, editor = this.toolbar.editor;\n                    editor.on(\"keydown\", function(evt) {\n                        if (evt.which === 66 && (evt.ctrlKey || evt.metaKey)) {\n                            evt.preventDefault();\n                            self.click();\n                        }\n                    });\n                }\n            });\n            exports.Italic = Class(Inline, {\n                defaults: extend({}, Inline.prototype.defaults, {\n                    label: \"I\",\n                    title: \"Italic\",\n                    fontAwesomeID: \"italic\"\n                }),\n                tagList: [ \"i\", \"em\" ],\n                command: \"italic\",\n                init: function() {\n                    Inline.prototype.init.apply(this, arguments);\n                    var self = this, editor = this.toolbar.editor;\n                    editor.on(\"keydown\", function(evt) {\n                        if (evt.which === 73 && (evt.ctrlKey || evt.metaKey)) {\n                            evt.preventDefault();\n                            self.click();\n                        }\n                    });\n                }\n            });\n            exports.Underline = Class(Inline, {\n                defaults: extend({}, Inline.prototype.defaults, {\n                    label: \"U\",\n                    title: \"Underline\",\n                    fontAwesomeID: \"underline\"\n                }),\n                tagList: [ \"u\", \"ins\" ],\n                command: \"underline\"\n            });\n            exports.StrikeThrough = Class(Inline, {\n                defaults: extend({}, Inline.prototype.defaults, {\n                    label: \"S\",\n                    title: \"Strike-Through\",\n                    fontAwesomeID: \"strikethrough\"\n                }),\n                tagList: [ \"strike\", \"del\" ],\n                command: \"strikeThrough\"\n            });\n            var LinkDialog = Class(Dialog, {\n                show: function(node) {\n                    var control = this.control, editor = this.toolbar.editor, selection = rangy.saveSelection();\n                    editor.showDialog(function() {\n                        input.focus();\n                    });\n                    var input = this.addTextField(\"URL: \", {\n                        escape: function() {\n                            editor.restoreSelection(selection);\n                        },\n                        enter: function(evt) {\n                            editor.restoreSelection(selection);\n                            control.saveLink(node, evt.target.value);\n                        }\n                    });\n                    this.addButton(\"Save\", {\n                        fontAwesomeID: \"check\",\n                        click: function(evt) {\n                            evt.stopImmediatePropagation();\n                            editor.restoreSelection(selection);\n                            control.saveLink(node, input.value);\n                        }\n                    });\n                    if (node) {\n                        input.value = node.getAttribute(\"href\");\n                        this.addButton(\"Remove\", {\n                            fontAwesomeID: \"chain-broken\",\n                            click: function(evt) {\n                                evt.stopImmediatePropagation();\n                                editor.restoreSelection(selection);\n                                control.saveLink(node, null);\n                            }\n                        });\n                    }\n                }\n            });\n            exports.Link = Class(Button, {\n                defaults: extend({}, Button.prototype.defaults, {\n                    label: \"#\",\n                    base_title: \"Link\",\n                    title: \"\",\n                    fontAwesomeID: \"link\"\n                }),\n                init: function() {\n                    Button.prototype.init.apply(this, arguments);\n                    var self = this, editor = this.toolbar.editor;\n                    editor.on(\"keydown\", function(evt) {\n                        if (evt.which === 75 && evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {\n                            evt.preventDefault();\n                            self.click();\n                        }\n                    });\n                },\n                isHighlighted: function() {\n                    var title = this.options.base_title;\n                    var nodes = this.toolbar.editor.filterTopNodeNames(\"a\");\n                    if (nodes.length > 0) {\n                        title += \": \" + nodes[0].href;\n                    }\n                    this.element.setAttribute(\"title\", title);\n                    return nodes.length > 0;\n                },\n                isVisible: function() {\n                    return !this.toolbar.editor.getSelection().isCollapsed || this.isHighlighted();\n                },\n                click: function() {\n                    var editor = this.toolbar.editor, collapsed = editor.getSelection().isCollapsed;\n                    var node = editor.filterTopNodeNames(\"a\");\n                    if (collapsed && node.length === 0) {\n                        return;\n                    }\n                    node = node.length === 0 ? null : node[0];\n                    if (collapsed) {\n                        editor.setRange(node);\n                    }\n                    new LinkDialog(this).show(node);\n                },\n                saveLink: function(node, url) {\n                    var editor = this.toolbar.editor, range = editor.getRange();\n                    if (node) {\n                        if (!url) {\n                            var selection = rangy.saveSelection();\n                            rangy.dom.replaceNodeByContents(node, true);\n                            rangy.restoreSelection(selection);\n                            rangy.removeMarkers(selection);\n                        } else {\n                            node.setAttribute(\"href\", url);\n                            editor.setRange(node);\n                        }\n                    } else if (url) {\n                        node = document.createElement(\"a\");\n                        node.setAttribute(\"href\", url);\n                        var contents = range.cloneContents();\n                        _.each(contents.childNodes, function(n) {\n                            node.appendChild(n.cloneNode(true));\n                        });\n                        range.deleteContents();\n                        range.insertNode(node);\n                        editor.setRange(node);\n                    }\n                    editor.showToolbar();\n                    return node;\n                }\n            });\n        }, {\n            \"../../vendor/rangy/core\": 11,\n            \"../controls\": 1,\n            \"../util\": 9\n        } ],\n        4: [ function(_dereq_, module, exports) {\n            var _util = _dereq_(\"../util\"), _controls = _dereq_(\"../controls\"), rangy = _dereq_(\"../../vendor/rangy/core\").api, Class = _util.Class, extend = _util.extend, Button = _controls.Button, Dialog = _controls.Dialog;\n            var ImageDialog = Class(Dialog, {\n                show: function(node) {\n                    var control = this.control, editor = this.toolbar.editor, selection = rangy.saveSelection();\n                    editor.showDialog(function() {\n                        input.focus();\n                    });\n                    var input = this.addTextField(\"URL: \", {\n                        escape: function() {\n                            editor.restoreSelection(selection);\n                        },\n                        enter: function(evt) {\n                            editor.restoreSelection(selection);\n                            control.saveImage(node, evt.target.value);\n                        }\n                    });\n                    this.addButton(\"Save\", {\n                        fontAwesomeID: \"check\",\n                        click: function(evt) {\n                            evt.stopImmediatePropagation();\n                            editor.restoreSelection(selection);\n                            control.saveImage(node, input.value);\n                        }\n                    });\n                    if (node) {\n                        input.value = node.getAttribute(\"src\");\n                    }\n                }\n            });\n            exports.Image = Class(Button, {\n                defaults: extend({}, Button.prototype.defaults, {\n                    label: \"IMG\",\n                    title: \"Image\",\n                    fontAwesomeID: \"picture-o\"\n                }),\n                init: function() {\n                    Button.prototype.init.apply(this, arguments);\n                    var editor = this.toolbar.editor;\n                    editor.on(\"click\", function(evt) {\n                        if (evt.target.tagName.toLowerCase() === \"img\") {\n                            editor.setRange(evt.target);\n                            editor.showToolbar();\n                        }\n                    });\n                },\n                isHighlighted: function() {\n                    return this.toolbar.editor.filterTopNodeNames(\"img\").length > 0;\n                },\n                click: function() {\n                    var editor = this.toolbar.editor, node = editor.filterTopNodeNames(\"img\");\n                    node = node.length === 0 ? null : node[0];\n                    new ImageDialog(this).show(node);\n                },\n                saveImage: function(node, url) {\n                    var editor = this.toolbar.editor, range = editor.getRange();\n                    if (node && url) {\n                        node.setAttribute(\"src\", url);\n                        editor.setRange(node);\n                    } else if (url) {\n                        node = document.createElement(\"img\");\n                        node.setAttribute(\"src\", url);\n                        range.deleteContents();\n                        range.insertNode(node);\n                        editor.cleanBlock(node.parentNode);\n                        editor.setRange(node);\n                    }\n                    editor.showToolbar();\n                    return node;\n                }\n            });\n            // exports.Oembed = Class(Button, {\n            //     defaults: extend({}, Button.prototype.defaults, {\n            //         label: \"Embeded\",\n            //         title: \"Embeded content\",\n            //         fontAwesomeID: \"youtube-play\"\n            //     }),\n            //     click: function() {\n            //         // window.alert(\"No implemented yet :)\");\n            //     }\n            // });\n        }, {\n            \"../../vendor/rangy/core\": 11,\n            \"../controls\": 1,\n            \"../util\": 9\n        } ],\n        5: [ function(_dereq_, module, exports) {\n            var rangy = _dereq_(\"../vendor/rangy/core\").api;\n            var extend = _dereq_(\"./util\").extend;\n            var Class = _dereq_(\"./util\").Class;\n            var Toolbar = _dereq_(\"./toolbar\").Toolbar;\n            var _ = _dereq_(\"./util\")._;\n            var HtmlCleaner = _dereq_(\"./html-cleaner\").HtmlCleaner;\n            var Editor = Class(Object, {\n                defaults: {\n                    delay: 300,\n                    diffLeft: 2,\n                    diffTop: -10,\n                    classPrefix: \"editor-\",\n                    fontAwesomeEnabled: true\n                },\n                BLOCK_NODES: \"P H1 H2 H3 H4 H5 H6 UL OL PRE DL DIV NOSCRIPT BLOCKQUOTE FORM HR TABLE FIELDSET ADDRESS\".split(\" \"),\n                init: function(element, options) {\n                    if (!window.getSelection) {\n                        throw new Error(\"Browser features missing.\");\n                    }\n                    if (typeof element !== \"object\") {\n                        return;\n                    }\n                    this.element = element;\n                    if (!rangy.initialized) {\n                        rangy.init();\n                    }\n                    this.isActive = true;\n                    this.isSelected = false;\n                    this.options = extend({}, this.defaults, options);\n                    this._currentEditor = null;\n                    this._resizeHandler = function(self) {\n                        var timeout = null;\n                        return function() {\n                            clearTimeout(timeout);\n                            timeout = setTimeout(function() {\n                                self.setToolbarPosition();\n                            }, 250);\n                        };\n                    }(this);\n                    this.initElement().initToolbar().bindSelect().bindTyping();\n                },\n                on: function(name, handler) {\n                    this.element.addEventListener(name, handler);\n                },\n                off: function(name, handler) {\n                    this.element.removeEventListener(name, handler);\n                },\n                initElement: function() {\n                    var self = this;\n                    this.element.setAttribute(\"contentEditable\", true);\n                    this.element.setAttribute(\"data-editor-element\", true);\n                    this.on(\"focus\", function() {\n                        self._onFocus();\n                    });\n                    return this;\n                },\n                bindSelect: function() {\n                    var self = this, timeout = null;\n                    var wrapper = function(evt) {\n                        clearTimeout(timeout);\n                        timeout = setTimeout(function() {\n                            self._onSelect(evt);\n                        }, self.options.delay);\n                    };\n                    document.addEventListener(\"mouseup\", wrapper);\n                    document.addEventListener(\"keyup\", wrapper);\n                    return this;\n                },\n                bindTyping: function() {\n                    var self = this;\n                    this.on(\"keyup\", function(evt) {\n                        var selection = self.getSelection();\n                        if (evt.which !== 9 && selection.isCollapsed && selection.getEnclosingNode() === self._currentEditor) {\n                            self.exec(\"formatBlock\", \"p\");\n                        }\n                    });\n                    return this;\n                },\n                initToolbar: function() {\n                    var self = this;\n                    this.toolbar = new Toolbar(this, {\n                        classPrefix: this.options.classPrefix,\n                        fontAwesomeEnabled: this.options.fontAwesomeEnabled\n                    });\n                    this.toolbar.element.addEventListener(\"toolbar.show\", function() {\n                        self.focus();\n                    });\n                    this.toolbar.element.addEventListener(\"toolbar.hide\", function() {\n                        var elements = self.element.querySelectorAll(\"span.rangySelectionBoundary\");\n                        _.each(elements, function(e) {\n                            e.parentNode.removeChild(e);\n                        });\n                    });\n                    return this;\n                },\n                exec: function(cmd, arg) {\n                    document.execCommand(cmd, false, arg);\n                },\n                focus: function() {\n                    if (this._currentEditor) {\n                        this._currentEditor.focus();\n                    }\n                },\n                showToolbar: function() {\n                    this.toolbar.hideDialog();\n                    this.toolbar.show();\n                    this.setToolbarPosition();\n                    window.addEventListener(\"resize\", this._resizeHandler);\n                    return this;\n                },\n                hideToolbar: function() {\n                    window.removeEventListener(\"resize\", this._resizeHandler);\n                    this.toolbar.hide();\n                    return this;\n                },\n                showDialog: function(callback) {\n                    var self = this;\n                    this.toolbar.showDialog();\n                    setTimeout(function() {\n                        self.setToolbarPosition();\n                        if (typeof callback === \"function\") {\n                            callback.call(self);\n                        }\n                    }, 20);\n                    return this;\n                },\n                setToolbarPosition: function() {\n                    var selection = this.getSelection(), range = this.getRange(), node = selection.getEnclosingNode(), height = this.toolbar.element.offsetHeight, width = this.toolbar.element.offsetWidth, boundary;\n                    if (!selection.isCollapsed && rangy.util.isHostMethod(range.nativeRange, \"getBoundingClientRect\")) {\n                        boundary = range.nativeRange.getBoundingClientRect();\n                    } else {\n                        while (node.parentNode.childNodes.length === 1) {\n                            node = node.parentNode;\n                        }\n                        boundary = node.getBoundingClientRect();\n                    }\n                    var top = 0;\n                    if (boundary.top < height) {\n                        top = boundary.bottom - this.options.diffTop + window.pageYOffset;\n                    } else {\n                        top = boundary.top + this.options.diffTop + window.pageYOffset - height;\n                    }\n                    var left = boundary.left - this.options.diffLeft;\n                    if (this._currentEditor.offsetWidth < width + boundary.left) {\n                        left = boundary.right - width + this.options.diffLeft;\n                    }\n                    this.toolbar.move(top, left);\n                },\n                restoreSelection: function(selection, showToolbar) {\n                    showToolbar = typeof showToolbar === \"undefined\" ? true : showToolbar;\n                    rangy.restoreSelection(selection);\n                    rangy.removeMarkers(selection);\n                    this.element.focus();\n                    if (showToolbar) {\n                        this.showToolbar();\n                    }\n                },\n                _onFocus: function() {\n                    this._currentEditor = this.element;\n                },\n                _onSelect: function(evt) {\n                    var elements = [ this.element, this.toolbar.element ];\n                    if (!rangy.dom.hasParents(evt.target, elements)) {\n                        if (this.isSelected) {\n                            this.hideToolbar();\n                            this._currentEditor = null;\n                            this.isSelected = false;\n                        }\n                        return;\n                    }\n                    this._currentEditor = this.element;\n                    if (!rangy.dom.hasParents(evt.target, [ this.toolbar.element ])) {\n                        this.showToolbar();\n                    }\n                    if (!this.isSelected) {\n                        this.isSelected = true;\n                        if (evt.which === 9) {\n                            this.selectStart();\n                        }\n                    }\n                },\n                selectStart: function() {\n                    var selection = this.getSelection();\n                    if (!selection.isCollapsed) {\n                        return;\n                    }\n                    if (this.element.childNodes.length > 0 && this.element.firstChild.nodeType === 3) {\n                        if (this.element.firstChild.textContent.replace(/^\\s*(.*?)\\s*$/, \"$1\") === \"\") {\n                            this.element.removeChild(this.element.firstChild);\n                        }\n                    }\n                    var node, nodes;\n                    if (this.element.childNodes.length > 0) {\n                        node = this.element.firstChild;\n                        nodes = rangy.dom.getNodes(node, 3);\n                        if (nodes.length > 0) {\n                            node = nodes[0];\n                        }\n                    } else {\n                        node = document.createElement(\"p\");\n                        this.element.appendChild(node);\n                        node.appendChild(document.createTextNode(\"\"));\n                        node = node.firstChild;\n                    }\n                    if (node.nodeType === 3) {\n                        var range = rangy.createRange();\n                        range.setStart(node, 0);\n                        this.getSelection().setSingleRange(range);\n                    } else {\n                        this.setRange(node);\n                    }\n                    this.showToolbar();\n                },\n                getSelection: function() {\n                    return rangy.getSelection();\n                },\n                getRange: function(index) {\n                    index = typeof index === \"undefined\" ? 0 : index;\n                    return this.getSelection().getRangeAt(0);\n                },\n                setRange: function(node, end) {\n                    if (typeof node === \"undefined\") {\n                        return;\n                    }\n                    var range = rangy.createRange();\n                    range.selectNodeContents(node);\n                    if (end && end !== node) {\n                        if (end.lastChild) {\n                            range.setEndAfter(end.lastChild);\n                        } else {\n                            range.setEndAfter(end);\n                        }\n                    }\n                    this.getSelection().setSingleRange(range);\n                },\n                getEnclosingNode: function() {\n                    var selection = this.getSelection();\n                    if (selection.rangeCount !== 1) {\n                        return null;\n                    }\n                    var node = selection.getEnclosingNode();\n                    if (node === this._currentEditor) {\n                        return null;\n                    }\n                    return node;\n                },\n                getTopNodes: function(filter) {\n                    var selection = this.getSelection();\n                    if (selection.rangeCount !== 1) {\n                        return [];\n                    }\n                    return selection.getTopNodes(this._currentEditor, filter);\n                },\n                getSurroundingNodes: function(filter) {\n                    var selection = this.getSelection();\n                    if (selection.rangeCount !== 1) {\n                        return [];\n                    }\n                    return selection.getSurroundingNodes(filter);\n                },\n                filterTopNodeNames: function() {\n                    var names = _.map(arguments, function(v) {\n                        return v.toLowerCase();\n                    });\n                    return this.getTopNodes(function(n) {\n                        return names.indexOf(n.nodeName.toLowerCase()) !== -1;\n                    });\n                },\n                cleanBlock: function(node) {\n                    var e = node.childNodes[node.childNodes.length - 1];\n                    if (e.nodeType === 1 && e.nodeName.toLowerCase() === \"br\") {\n                        node.removeChild(e);\n                    }\n                },\n                serialize: function(clean) {\n                    var html = this.element.innerHTML;\n                    if (clean) {\n                        var cleaner = new HtmlCleaner();\n                        html = cleaner.clean(html);\n                    }\n                    return html;\n                }\n            });\n            exports.Editor = Editor;\n            var controls = {\n                Menu: _dereq_(\"./controls\").Menu,\n                inline: _dereq_(\"./controls/inline\"),\n                block: _dereq_(\"./controls/block\"),\n                media: _dereq_(\"./controls/media\")\n            };\n            exports.controls = controls;\n            exports.simpleEditor = Class(Editor, {\n                init: function() {\n                    Editor.prototype.init.apply(this, arguments);\n                    this.toolbar.addControl(controls.Menu, \"blocks\", {\n                        label: \"\",\n                        title: \"Blocks\",\n                        controls: [ [ controls.block.Paragraph, \"p\" ], [ controls.block.H1, \"h1\" ], [ controls.block.H2, \"h2\" ], [ controls.block.H3, \"h3\" ], [ controls.block.Preformated, \"pre\" ] ]\n                    });\n                    this.toolbar.addControl(controls.Menu, \"lists\", {\n                        label: \"Lists\",\n                        title: \"Lists\",\n                        fontAwesomeID: \"list-ul\",\n                        controls: [ [ controls.block.UnorderedList, \"ul\" ], [ controls.block.OrderedList, \"ol\" ] ]\n                    });\n                    this.toolbar.addControl(controls.block.Blockquote, \"quote\");\n                    this.toolbar.addControl(controls.inline.Bold, \"bold\");\n                    this.toolbar.addControl(controls.inline.Italic, \"italic\");\n                    this.toolbar.addControl(controls.inline.Underline, \"underline\");\n                    this.toolbar.addControl(controls.inline.StrikeThrough, \"strike\");\n                    this.toolbar.addControl(controls.inline.Link, \"link\");\n                    this.toolbar.addControl(controls.media.Image, \"image\");\n                    this.toolbar.addControl(controls.media.Oembed, \"oembed\");\n                }\n            });\n        }, {\n            \"../vendor/rangy/core\": 11,\n            \"./controls\": 1,\n            \"./controls/block\": 2,\n            \"./controls/inline\": 3,\n            \"./controls/media\": 4,\n            \"./html-cleaner\": 6,\n            \"./toolbar\": 8,\n            \"./util\": 9\n        } ],\n        6: [ function(_dereq_, module, exports) {\n            var Class = _dereq_(\"./util\").Class;\n            var extend = _dereq_(\"./util\").extend;\n            var _ = _dereq_(\"./util\")._;\n            var HtmlCleaner = Class(Object, {\n                defaults: {},\n                init: function(options) {\n                    this.options = extend({}, this.defaults, options);\n                },\n                formatRegexp: [ [ /(<[a-z][^>]*)margin\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)margin-bottom\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)margin-left\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)margin-right\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)margin-top\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)padding\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)padding-bottom\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)padding-left\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)padding-right\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)padding-top\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)font\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)font-family\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)font-size\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)font-style\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)font-variant\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)font-weight\\s*:[^;]*;/gm, \"$1\" ], [ /(<[a-z][^>]*)color\\s*:[^;]*;/gm, \"$1\" ] ],\n                cleanRegexp: [ [ /<meta[\\w\\W]*?>/gim, \"\" ], [ /<style[\\w\\W]*?>[\\w\\W]*?<\\/style>/gim, \"\" ], [ /<\\/?font[\\w\\W]*?>/gim, \"\" ], [ /<(\\/?)(B|b|STRONG)([\\s>\\/])/g, \"<$1strong$3\" ], [ /<(\\/?)(I|i|EM)([\\s>\\/])/g, \"<$1em$3\" ], [ /<IMG ([^>]*?[^\\/])>/gi, \"<img $1 />\" ], [ /<INPUT ([^>]*?[^\\/])>/gi, \"<input $1 />\" ], [ /<COL ([^>]*?[^\\/])>/gi, \"<col $1 />\" ], [ /<AREA ([^>]*?[^\\/])>/gi, \"<area $1 />\" ], [ /<PARAM ([^>]*?[^\\/])>/gi, \"<param $1 />\" ], [ /<HR ([^>]*?[^\\/])>/gi, \"<hr $1/>\" ], [ /<BR ([^>]*?[^\\/])>/gi, \"<br $1/>\" ], [ /<(\\/?)U([\\s>\\/])/gi, \"<$1ins$2\" ], [ /<(\\/?)STRIKE([\\s>\\/])/gi, \"<$1del$2\" ], [ /<span style=\"font-weight: normal;\">([\\w\\W]*?)<\\/span>/gm, \"$1\" ], [ /<span style=\"font-weight: bold;\">([\\w\\W]*?)<\\/span>/gm, \"<strong>$1</strong>\" ], [ /<span style=\"font-style: italic;\">([\\w\\W]*?)<\\/span>/gm, \"<em>$1</em>\" ], [ /<span style=\"text-decoration: underline;\">([\\w\\W]*?)<\\/span>/gm, \"<ins>$1</ins>\" ], [ /<span style=\"text-decoration: line-through;\">([\\w\\W]*?)<\\/span>/gm, \"<del>$1</del>\" ], [ /<span style=\"text-decoration: underline line-through;\">([\\w\\W]*?)<\\/span>/gm, \"<del><ins>$1</ins></del>\" ], [ /<span style=\"(font-weight: bold; ?|font-style: italic; ?){2}\">([\\w\\W]*?)<\\/span>/gm, \"<strong><em>$2</em></strong>\" ], [ /<span style=\"(font-weight: bold; ?|text-decoration: underline; ?){2}\">([\\w\\W]*?)<\\/span>/gm, \"<ins><strong>$2</strong></ins>\" ], [ /<span style=\"(font-weight: italic; ?|text-decoration: underline; ?){2}\">([\\w\\W]*?)<\\/span>/gm, \"<ins><em>$2</em></ins>\" ], [ /<span style=\"(font-weight: bold; ?|text-decoration: line-through; ?){2}\">([\\w\\W]*?)<\\/span>/gm, \"<del><strong>$2</strong></del>\" ], [ /<span style=\"(font-weight: italic; ?|text-decoration: line-through; ?){2}\">([\\w\\W]*?)<\\/span>/gm, \"<del><em>$2</em></del>\" ], [ /<span style=\"(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline; ?){3}\">([\\w\\W]*?)<\\/span>/gm, \"<ins><strong><em>$2</em></strong></ins>\" ], [ /<span style=\"(font-weight: bold; ?|font-style: italic; ?|text-decoration: line-through; ?){3}\">([\\w\\W]*?)<\\/span>/gm, \"<del><strong><em>$2</em></strong></del>\" ], [ /<span style=\"(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline line-through; ?){3}\">([\\w\\W]*?)<\\/span>/gm, \"<del><ins><strong><em>$2</em></strong></ins></del>\" ], [ /<strong style=\"font-weight: normal;\">([\\w\\W]*?)<\\/strong>/gm, \"$1\" ], [ /<([a-z]+) style=\"font-weight: normal;\">([\\w\\W]*?)<\\/\\1>/gm, \"<$1>$2</$1>\" ], [ /<([a-z]+) style=\"font-weight: bold;\">([\\w\\W]*?)<\\/\\1>/gm, \"<$1><strong>$2</strong></$1>\" ], [ /<([a-z]+) style=\"font-style: italic;\">([\\w\\W]*?)<\\/\\1>/gm, \"<$1><em>$2</em></$1>\" ], [ /<([a-z]+) style=\"text-decoration: underline;\">([\\w\\W]*?)<\\/\\1>/gm, \"<ins><$1>$2</$1></ins>\" ], [ /<([a-z]+) style=\"text-decoration: line-through;\">([\\w\\W]*?)<\\/\\1>/gm, \"<del><$1>$2</$1></del>\" ], [ /<([a-z]+) style=\"text-decoration: underline line-through;\">([\\w\\W]*?)<\\/\\1>/gm, \"<del><ins><$1>$2</$1></ins></del>\" ], [ /<([a-z]+) style=\"(font-weight: bold; ?|font-style: italic; ?){2}\">([\\w\\W]*?)<\\/\\1>/gm, \"<$1><strong><em>$3</em></strong></$1>\" ], [ /<([a-z]+) style=\"(font-weight: bold; ?|text-decoration: underline; ?){2}\">([\\w\\W]*?)<\\/\\1>/gm, \"<ins><$1><strong>$3</strong></$1></ins>\" ], [ /<([a-z]+) style=\"(font-weight: italic; ?|text-decoration: underline; ?){2}\">([\\w\\W]*?)<\\/\\1>/gm, \"<ins><$1><em>$3</em></$1></ins>\" ], [ /<([a-z]+) style=\"(font-weight: bold; ?|text-decoration: line-through; ?){2}\">([\\w\\W]*?)<\\/\\1>/gm, \"<del><$1><strong>$3</strong></$1></del>\" ], [ /<([a-z]+) style=\"(font-weight: italic; ?|text-decoration: line-through; ?){2}\">([\\w\\W]*?)<\\/\\1>/gm, \"<del><$1><em>$3</em></$1></del>\" ], [ /<([a-z]+) style=\"(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline; ?){3}\">([\\w\\W]*?)<\\/\\1>/gm, \"<ins><$1><strong><em>$3</em></strong></$1></ins>\" ], [ /<([a-z]+) style=\"(font-weight: bold; ?|font-style: italic; ?|text-decoration: line-through; ?){3}\">([\\w\\W]*?)<\\/\\1>/gm, \"<del><$1><strong><em>$3</em></strong></$1></del>\" ], [ /<([a-z]+) style=\"(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline line-through; ?){3}\">([\\w\\W]*?)<\\/\\1>/gm, \"<del><ins><$1><strong><em>$3</em></strong></$1></ins></del>\" ], [ /<p><blockquote>(.*)(\\n)+<\\/blockquote><\\/p>/i, \"<blockquote>$1</blockquote>\\n\" ], [ /<\\/(strong|em|ins|del|q|code)>(\\s*?)<\\1>/gim, \"$2\" ], [ /<(br|BR)>/g, \"<br />\" ], [ /<(hr|HR)>/g, \"<hr />\" ], [ /([^\\s])\\/>/g, \"$1 />\" ], [ /<br \\/>\\s*<\\/(h1|h2|h3|h4|h5|h6|ul|ol|li|p|blockquote|div)/gi, \"</$1\" ], [ /<\\/(h1|h2|h3|h4|h5|h6|ul|ol|li|p|blockquote)>([^\\n\\u000B\\r\\f])/gi, \"</$1>\\n$2\" ], [ /<hr style=\"width: 100%; height: 2px;\" \\/>/g, \"<hr />\" ], [ /style=\"\\s*?\"/gim, \"\" ], [ /<\\s+/gim, \"<\" ], [ /\\s+>/gim, \">\" ] ],\n                removeFormat: function(html) {\n                    _.each(this.formatRegexp, function(v) {\n                        html = \"\".replace.apply(html, v);\n                    });\n                    return html;\n                },\n                tagsoup2html: function(html) {\n                    _.each(this.cleanRegexp, function(v) {\n                        html = \"\".replace.apply(html, v);\n                    });\n                    while (/(<[^\\/!]>|<[^\\/!][^>]*[^\\/]>)\\s*<\\/[^>]*[^-]>/.test(html)) {\n                        html = html.replace(/(<[^\\/!]>|<[^\\/!][^>]*[^\\/]>)\\s*<\\/[^>]*[^-]>/g, \"\");\n                    }\n                    html = html.replace(/<(\\/?)([A-Z0-9]+)/g, function(m0, m1, m2) {\n                        return \"<\" + m1 + m2.toLowerCase();\n                    });\n                    var reg = /<[^>]+((\\s+\\w+\\s*=\\s*)([^\"'][\\w~@+$,%\\/:.#?=&;!*()-]*))[^>]*?>/;\n                    var _f = function(m0, m1, m2, m3) {\n                        var _r = m1.replace(/([\\\\\\^\\$*+[\\]?{}.=!:(|)])/g, \"\\\\$1\");\n                        return m0.replace(_r, m2 + '\"' + m3 + '\"');\n                    };\n                    while (reg.test(html)) {\n                        html = html.replace(reg, _f);\n                    }\n                    while (/(<[^>]+style=([\"'])[^>]+[\\s:]+)0(pt|px)(\\2|\\s|;)/.test(html)) {\n                        html = html.replace(/(<[^>]+style=([\"'])[^>]+[\\s:]+)0(pt|px)(\\2|\\s|;)/gi, \"$1\" + \"0$4\");\n                    }\n                    html = html.replace(/\\r\\n/g, \"\\n\");\n                    html = html.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\n                    return html;\n                },\n                clean: function(html) {\n                    html = this.removeFormat(html);\n                    html = this.tagsoup2html(html);\n                    return html;\n                }\n            });\n            exports.HtmlCleaner = HtmlCleaner;\n        }, {\n            \"./util\": 9\n        } ],\n        7: [ function(_dereq_, module, exports) {\n            var rangy = _dereq_(\"../vendor/rangy/core\");\n            var _ = _dereq_(\"./util\")._;\n            rangy.api.createCoreModule(\"RangyExtensions\", [], function(api) {\n                api.selectionPrototype.getBoundaryNodes = function() {\n                    var startNode, startOffset, endNode, endOffset;\n                    if (!this.isBackwards()) {\n                        startNode = this.anchorNode;\n                        startOffset = this.anchorOffset;\n                        endNode = this.focusNode;\n                        endOffset = this.focusOffset;\n                    } else {\n                        startNode = this.focusNode;\n                        startOffset = this.focusOffset;\n                        endNode = this.anchorNode;\n                        endOffset = this.anchorOffset;\n                    }\n                    if (startNode.nodeType === 3 && startNode.nextSibling && startNode.length === startOffset) {\n                        startNode = startNode.nextSibling;\n                    } else if (startNode.nodeType === 1 && startNode.childNodes.length > startOffset) {\n                        startNode = startNode.childNodes[startOffset];\n                    }\n                    while (startNode.firstChild && startNode.firstChild.nodeType === 1) {\n                        startNode = startNode.firstChild;\n                    }\n                    if (endNode.nodeType === 3 && endNode.previousSibling && endOffset === 0) {\n                        endNode = endNode.previousSibling;\n                    } else if (endOffset > 0 && endNode.nodeType === 1 && endNode.childNodes.length > 0) {\n                        endNode = endNode.childNodes[endOffset - 1];\n                    }\n                    while (endNode.lastChild && endNode.lastChild.nodeType === 1) {\n                        endNode = endNode.lastChild;\n                    }\n                    startNode = startNode && startNode.nodeType !== 1 ? startNode.parentNode : startNode;\n                    endNode = endNode && endNode.nodeType !== 1 ? endNode.parentNode : endNode;\n                    return {\n                        start: startNode,\n                        end: endNode\n                    };\n                };\n                api.selectionPrototype.getEnclosingNode = function() {\n                    var nodes = this.getBoundaryNodes(), node;\n                    if (nodes.start === nodes.end) {\n                        node = nodes.start;\n                    } else {\n                        node = api.dom.getCommonAncestor(nodes.start, nodes.end);\n                    }\n                    return api.dom.getDeepestNode(node);\n                };\n                api.selectionPrototype.getTopNodes = function(boundary, filter) {\n                    boundary = boundary || document.body;\n                    var node = this.getEnclosingNode(), result = [ node ];\n                    if (node === boundary) {\n                        return [];\n                    }\n                    while (node.parentNode !== boundary) {\n                        node = node.parentNode;\n                        result.push(node);\n                    }\n                    return typeof filter === \"function\" ? _.filter(result, filter) : result;\n                };\n                api.selectionPrototype.getSurroundingNodes = function(filter) {\n                    var nodes = this.getBoundaryNodes(), parent = this.getEnclosingNode(), started = false, node, result = [];\n                    if (api.dom.isAncestorOf(nodes.start, nodes.end, true)) {\n                        return [ nodes.start ];\n                    }\n                    if (api.dom.isAncestorOf(nodes.end, nodes.start, true)) {\n                        return [ nodes.end ];\n                    }\n                    for (var i = 0; i < parent.childNodes.length; i++) {\n                        node = parent.childNodes[i];\n                        if (!started) {\n                            started = api.dom.isAncestorOf(node, nodes.start, true);\n                        }\n                        if (started) {\n                            result.push(node);\n                        }\n                        if (api.dom.isAncestorOf(node, nodes.end, true)) {\n                            break;\n                        }\n                    }\n                    return typeof filter === \"function\" ? _.filter(result, filter) : result;\n                };\n                api.dom.hasParents = function(node, parents) {\n                    while ([ document, document.body ].indexOf(node) === -1 && node != null) {\n                        if (parents.indexOf(node) !== -1) {\n                            return true;\n                        }\n                        node = node.parentNode;\n                    }\n                    return false;\n                };\n                api.dom.getDeepestNode = function(node) {\n                    while (node.childNodes.length === 1 && node.firstChild.nodeType === 1) {\n                        node = node.firstChild;\n                    }\n                    return node;\n                };\n                api.dom.replaceNodeByContents = function(node) {\n                    var content = this.getDocument(node).createDocumentFragment();\n                    _.each(node.childNodes, function(n) {\n                        content.appendChild(n.cloneNode(true));\n                    });\n                    node.parentNode.replaceChild(content, node);\n                };\n                api.dom.getNodes = function(node, nodeType, inloop) {\n                    var result = [];\n                    if (!inloop && (typeof nodeType === \"undefined\" || node.nodeType === nodeType)) {\n                        result.push(node);\n                    }\n                    for (var i = 0; i < node.childNodes.length; i++) {\n                        if (typeof nodeType === \"undefined\" || node.childNodes[i].nodeType === nodeType) {\n                            result.push(node.childNodes[i]);\n                        }\n                        [].push.apply(result, api.dom.getNodes(node.childNodes[i], nodeType, true));\n                    }\n                    return result;\n                };\n            });\n        }, {\n            \"../vendor/rangy/core\": 11,\n            \"./util\": 9\n        } ],\n        8: [ function(_dereq_, module, exports) {\n            var _util = _dereq_(\"./util\"), _controls = _dereq_(\"./controls\"), ControlsMixin = _controls.ControlsMixin, extend = _util.extend, Class = _util.Class;\n            var Toolbar = Class(Object, {\n                defaults: {\n                    classPrefix: \"\",\n                    fontAwesomeEnabled: false\n                },\n                init: function(editor, options) {\n                    ControlsMixin.prototype.init.call(this);\n                    this.editor = editor;\n                    this.options = extend({}, this.defaults, options || {});\n                    this.element = document.createElement(\"div\");\n                    this.container = document.createElement(\"ul\");\n                    this.dialog = document.createElement(\"div\");\n                    this.container.classList.add(this._getClassName(\"controls\"));\n                    this.element.classList.add(this._getClassName(\"toolbar\"));\n                    document.body.appendChild(this.element);\n                    this.dialog.classList.add(this._getClassName(\"dialog\"));\n                    this.dialog.style.display = \"none\";\n                    this.element.appendChild(this.container);\n                    this.element.appendChild(this.dialog);\n                    this.element.style.visibility = \"hidden\";\n                    this._showEvt = document.createEvent(\"Event\");\n                    this._showEvt.initEvent(\"toolbar.show\", false, true);\n                    this._hideEvt = document.createEvent(\"Event\");\n                    this._hideEvt.initEvent(\"toolbar.hide\", false, true);\n                    this._dirty = false;\n                },\n                _getClassName: function(name) {\n                    return this.options.classPrefix + name;\n                },\n                click: function(fn) {\n                    this.element.addEventListener(\"click\", fn);\n                },\n                focus: function(fn) {\n                    this.element.addEventListener(\"focus\", fn);\n                },\n                hide: function() {\n                    this.element.style.visibility = \"hidden\";\n                    this.element.dispatchEvent(this._hideEvt);\n                },\n                show: function() {\n                    if (this._dirty) {\n                        this.drawControls();\n                    }\n                    this.element.style.visibility = \"visible\";\n                    this.element.dispatchEvent(this._showEvt);\n                },\n                showDialog: function() {\n                    this.emptyDialog();\n                    this.dialog.style.display = \"block\";\n                    this.container.style.display = \"none\";\n                },\n                hideDialog: function() {\n                    this.dialog.style.display = \"none\";\n                    this.container.style.display = \"block\";\n                },\n                emptyDialog: function() {\n                    while (this.dialog.firstChild) {\n                        this.dialog.removeChild(this.dialog.firstChild);\n                    }\n                },\n                move: function(top, left) {\n                    this.element.style.top = top + \"px\";\n                    this.element.style.left = left + \"px\";\n                },\n                addControl: function(Klass, id, options) {\n                    this.controls[id] = new Klass(this, id, options);\n                    this._dirty = true;\n                },\n                removeControl: function(id) {\n                    if (!this.controls[id]) {\n                        return;\n                    }\n                    ControlsMixin.prototype.removeControl.call(this, id);\n                    this._dirty = true;\n                },\n                drawControls: function() {\n                    var control;\n                    while (this.container.firstChild) {\n                        this.container.removeChild(this.container.firstChild);\n                    }\n                    for (var id in this.controls) {\n                        control = this.controls[id];\n                        this.container.appendChild(control.drawElement());\n                    }\n                    this._dirty = false;\n                }\n            });\n            exports.Toolbar = Toolbar;\n        }, {\n            \"./controls\": 1,\n            \"./util\": 9\n        } ],\n        9: [ function(_dereq_, module, exports) {\n            var extend = function() {\n                var args = Array.prototype.slice.call(arguments);\n                var base = args.shift();\n                var type = \"\";\n                if (typeof base === \"string\" || typeof base === \"boolean\") {\n                    type = base === true ? \"deep\" : base;\n                    base = args.shift();\n                    if (type === \"defaults\") {\n                        base = extend({}, base);\n                        type = \"strict\";\n                    }\n                }\n                for (var i = 0, c = args.length; i < c; i++) {\n                    var prop = args[i];\n                    for (var name in prop) {\n                        if (type === \"deep\" && typeof prop[name] === \"object\" && typeof base[name] !== \"undefined\") {\n                            extend(type, base[name], prop[name]);\n                        } else if (type !== \"strict\" || type === \"strict\" && typeof base[name] !== \"undefined\") {\n                            base[name] = prop[name];\n                        }\n                    }\n                }\n                return base;\n            };\n            var Class = function(parent, proto) {\n                var C = function() {\n                    if (typeof this.init !== \"undefined\") {\n                        this.init.apply(this, arguments);\n                    }\n                };\n                var F = function() {};\n                F.prototype = parent.prototype;\n                C.prototype = new F();\n                C.prototype.constructor = parent;\n                extend(C.prototype, proto);\n                return C;\n            };\n            var _ = {};\n            var breaker = {};\n            var nativeForEach = Array.prototype.forEach, nativeMap = Array.prototype.map, nativeFilter = Array.prototype.filter;\n            _.each = function(obj, iterator, context) {\n                if (obj == null) return obj;\n                if (nativeForEach && obj.forEach === nativeForEach) {\n                    obj.forEach(iterator, context);\n                } else if (obj.length === +obj.length) {\n                    for (var i = 0, length = obj.length; i < length; i++) {\n                        if (iterator.call(context, obj[i], i, obj) === breaker) return;\n                    }\n                } else {\n                    var keys = _.keys(obj);\n                    for (var i = 0, length = keys.length; i < length; i++) {\n                        if (iterator.call(context, obj[keys[i]], keys[i], obj) === breaker) return;\n                    }\n                }\n                return obj;\n            };\n            _.map = function(obj, iterator, context) {\n                var results = [];\n                if (obj == null) return results;\n                if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n                _.each(obj, function(value, index, list) {\n                    results.push(iterator.call(context, value, index, list));\n                });\n                return results;\n            };\n            _.filter = function(obj, predicate, context) {\n                var results = [];\n                if (obj == null) return results;\n                if (nativeFilter && obj.filter === nativeFilter) return obj.filter(predicate, context);\n                _.each(obj, function(value, index, list) {\n                    if (predicate.call(context, value, index, list)) results.push(value);\n                });\n                return results;\n            };\n            exports.extend = extend;\n            exports.Class = Class;\n            exports._ = _;\n        }, {} ],\n        10: [ function(_dereq_, module, exports) {\n            exports.VERSION = \"0.3.0\";\n            exports.rangy = _dereq_(\"./vendor/rangy/core\").api;\n            _dereq_(\"./vendor/rangy/dom\");\n            _dereq_(\"./vendor/rangy/domrange\");\n            _dereq_(\"./vendor/rangy/selectionsaverestore\");\n            _dereq_(\"./vendor/rangy/wrappedrange\");\n            _dereq_(\"./vendor/rangy/wrappedselection\");\n            _dereq_(\"./lib/rangy-extensions\");\n            exports.extend = _dereq_(\"./lib/util\").extend;\n            exports.Class = _dereq_(\"./lib/util\").Class;\n            exports.HtmlCleaner = _dereq_(\"./lib/html-cleaner\").HtmlCleaner;\n            exports.Editor = _dereq_(\"./lib/editor\").Editor;\n            exports.controls = _dereq_(\"./lib/editor\").controls;\n            exports.simpleEditor = _dereq_(\"./lib/editor\").simpleEditor;\n        }, {\n            \"./lib/editor\": 5,\n            \"./lib/html-cleaner\": 6,\n            \"./lib/rangy-extensions\": 7,\n            \"./lib/util\": 9,\n            \"./vendor/rangy/core\": 11,\n            \"./vendor/rangy/dom\": 12,\n            \"./vendor/rangy/domrange\": 13,\n            \"./vendor/rangy/selectionsaverestore\": 14,\n            \"./vendor/rangy/wrappedrange\": 15,\n            \"./vendor/rangy/wrappedselection\": 16\n        } ],\n        11: [ function(_dereq_, module, exports) {\n            var OBJECT = \"object\", FUNCTION = \"function\", UNDEFINED = \"undefined\";\n            var domRangeProperties = [ \"startContainer\", \"startOffset\", \"endContainer\", \"endOffset\", \"collapsed\", \"commonAncestorContainer\" ];\n            var domRangeMethods = [ \"setStart\", \"setStartBefore\", \"setStartAfter\", \"setEnd\", \"setEndBefore\", \"setEndAfter\", \"collapse\", \"selectNode\", \"selectNodeContents\", \"compareBoundaryPoints\", \"deleteContents\", \"extractContents\", \"cloneContents\", \"insertNode\", \"surroundContents\", \"cloneRange\", \"toString\", \"detach\" ];\n            var textRangeProperties = [ \"boundingHeight\", \"boundingLeft\", \"boundingTop\", \"boundingWidth\", \"htmlText\", \"text\" ];\n            var textRangeMethods = [ \"collapse\", \"compareEndPoints\", \"duplicate\", \"moveToElementText\", \"parentElement\", \"select\", \"setEndPoint\", \"getBoundingClientRect\" ];\n            function isHostMethod(o, p) {\n                var t = typeof o[p];\n                return t == FUNCTION || !!(t == OBJECT && o[p]) || t == \"unknown\";\n            }\n            function isHostObject(o, p) {\n                return !!(typeof o[p] == OBJECT && o[p]);\n            }\n            function isHostProperty(o, p) {\n                return typeof o[p] != UNDEFINED;\n            }\n            function createMultiplePropertyTest(testFunc) {\n                return function(o, props) {\n                    var i = props.length;\n                    while (i--) {\n                        if (!testFunc(o, props[i])) {\n                            return false;\n                        }\n                    }\n                    return true;\n                };\n            }\n            var areHostMethods = createMultiplePropertyTest(isHostMethod);\n            var areHostObjects = createMultiplePropertyTest(isHostObject);\n            var areHostProperties = createMultiplePropertyTest(isHostProperty);\n            function isTextRange(range) {\n                return range && areHostMethods(range, textRangeMethods) && areHostProperties(range, textRangeProperties);\n            }\n            function getBody(doc) {\n                return isHostObject(doc, \"body\") ? doc.body : doc.getElementsByTagName(\"body\")[0];\n            }\n            var modules = {};\n            var api = {\n                version: \"1.3alpha.804\",\n                initialized: false,\n                supported: true,\n                util: {\n                    isHostMethod: isHostMethod,\n                    isHostObject: isHostObject,\n                    isHostProperty: isHostProperty,\n                    areHostMethods: areHostMethods,\n                    areHostObjects: areHostObjects,\n                    areHostProperties: areHostProperties,\n                    isTextRange: isTextRange,\n                    getBody: getBody\n                },\n                features: {},\n                modules: modules,\n                config: {\n                    alertOnFail: true,\n                    alertOnWarn: false,\n                    preferTextRange: false\n                }\n            };\n            function consoleLog(msg) {\n                if (isHostObject(window, \"console\") && isHostMethod(window.console, \"log\")) {\n                    window.console.log(msg);\n                }\n            }\n            function alertOrLog(msg, shouldAlert) {\n                if (shouldAlert) {\n                    window.alert(msg);\n                } else {\n                    consoleLog(msg);\n                }\n            }\n            function fail(reason) {\n                api.initialized = true;\n                api.supported = false;\n                alertOrLog(\"Rangy is not supported on this page in your browser. Reason: \" + reason, api.config.alertOnFail);\n            }\n            api.fail = fail;\n            function warn(msg) {\n                alertOrLog(\"Rangy warning: \" + msg, api.config.alertOnWarn);\n            }\n            api.warn = warn;\n            if ({}.hasOwnProperty) {\n                api.util.extend = function(obj, props, deep) {\n                    var o, p;\n                    for (var i in props) {\n                        if (props.hasOwnProperty(i)) {\n                            o = obj[i];\n                            p = props[i];\n                            if (deep && o !== null && typeof o == \"object\" && p !== null && typeof p == \"object\") {\n                                api.util.extend(o, p, true);\n                            }\n                            obj[i] = p;\n                        }\n                    }\n                    return obj;\n                };\n            } else {\n                fail(\"hasOwnProperty not supported\");\n            }\n            (function() {\n                var el = document.createElement(\"div\");\n                el.appendChild(document.createElement(\"span\"));\n                var slice = [].slice;\n                var toArray;\n                try {\n                    if (slice.call(el.childNodes, 0)[0].nodeType == 1) {\n                        toArray = function(arrayLike) {\n                            return slice.call(arrayLike, 0);\n                        };\n                    }\n                } catch (e) {}\n                if (!toArray) {\n                    toArray = function(arrayLike) {\n                        var arr = [];\n                        for (var i = 0, len = arrayLike.length; i < len; ++i) {\n                            arr[i] = arrayLike[i];\n                        }\n                        return arr;\n                    };\n                }\n                api.util.toArray = toArray;\n            })();\n            var addListener;\n            if (isHostMethod(document, \"addEventListener\")) {\n                addListener = function(obj, eventType, listener) {\n                    obj.addEventListener(eventType, listener, false);\n                };\n            } else if (isHostMethod(document, \"attachEvent\")) {\n                addListener = function(obj, eventType, listener) {\n                    obj.attachEvent(\"on\" + eventType, listener);\n                };\n            } else {\n                fail(\"Document does not have required addEventListener or attachEvent method\");\n            }\n            api.util.addListener = addListener;\n            var initListeners = [];\n            function getErrorDesc(ex) {\n                return ex.message || ex.description || String(ex);\n            }\n            function init() {\n                if (api.initialized) {\n                    return;\n                }\n                var testRange;\n                var implementsDomRange = false, implementsTextRange = false;\n                if (isHostMethod(document, \"createRange\")) {\n                    testRange = document.createRange();\n                    if (areHostMethods(testRange, domRangeMethods) && areHostProperties(testRange, domRangeProperties)) {\n                        implementsDomRange = true;\n                    }\n                    testRange.detach();\n                }\n                var body = getBody(document);\n                if (!body || body.nodeName.toLowerCase() != \"body\") {\n                    fail(\"No body element found\");\n                    return;\n                }\n                if (body && isHostMethod(body, \"createTextRange\")) {\n                    testRange = body.createTextRange();\n                    if (isTextRange(testRange)) {\n                        implementsTextRange = true;\n                    }\n                }\n                if (!implementsDomRange && !implementsTextRange) {\n                    fail(\"Neither Range nor TextRange are available\");\n                    return;\n                }\n                api.initialized = true;\n                api.features = {\n                    implementsDomRange: implementsDomRange,\n                    implementsTextRange: implementsTextRange\n                };\n                var module, errorMessage;\n                for (var moduleName in modules) {\n                    if ((module = modules[moduleName]) instanceof Module) {\n                        module.init(module, api);\n                    }\n                }\n                for (var i = 0, len = initListeners.length; i < len; ++i) {\n                    try {\n                        initListeners[i](api);\n                    } catch (ex) {\n                        errorMessage = \"Rangy init listener threw an exception. Continuing. Detail: \" + getErrorDesc(ex);\n                        consoleLog(errorMessage);\n                    }\n                }\n            }\n            api.init = init;\n            api.addInitListener = function(listener) {\n                if (api.initialized) {\n                    listener(api);\n                } else {\n                    initListeners.push(listener);\n                }\n            };\n            var createMissingNativeApiListeners = [];\n            api.addCreateMissingNativeApiListener = function(listener) {\n                createMissingNativeApiListeners.push(listener);\n            };\n            function createMissingNativeApi(win) {\n                win = win || window;\n                init();\n                for (var i = 0, len = createMissingNativeApiListeners.length; i < len; ++i) {\n                    createMissingNativeApiListeners[i](win);\n                }\n            }\n            api.createMissingNativeApi = createMissingNativeApi;\n            function Module(name, dependencies, initializer) {\n                this.name = name;\n                this.dependencies = dependencies;\n                this.initialized = false;\n                this.supported = false;\n                this.initializer = initializer;\n            }\n            Module.prototype = {\n                init: function(api) {\n                    var requiredModuleNames = this.dependencies || [];\n                    for (var i = 0, len = requiredModuleNames.length, requiredModule, moduleName; i < len; ++i) {\n                        moduleName = requiredModuleNames[i];\n                        requiredModule = modules[moduleName];\n                        if (!requiredModule || !(requiredModule instanceof Module)) {\n                            throw new Error(\"required module '\" + moduleName + \"' not found\");\n                        }\n                        requiredModule.init();\n                        if (!requiredModule.supported) {\n                            throw new Error(\"required module '\" + moduleName + \"' not supported\");\n                        }\n                    }\n                    this.initializer(this);\n                },\n                fail: function(reason) {\n                    this.initialized = true;\n                    this.supported = false;\n                    throw new Error(\"Module '\" + this.name + \"' failed to load: \" + reason);\n                },\n                warn: function(msg) {\n                    api.warn(\"Module \" + this.name + \": \" + msg);\n                },\n                deprecationNotice: function(deprecated, replacement) {\n                    api.warn(\"DEPRECATED: \" + deprecated + \" in module \" + this.name + \"is deprecated. Please use \" + replacement + \" instead\");\n                },\n                createError: function(msg) {\n                    return new Error(\"Error in Rangy \" + this.name + \" module: \" + msg);\n                }\n            };\n            function createModule(isCore, name, dependencies, initFunc) {\n                var newModule = new Module(name, dependencies, function(module) {\n                    if (!module.initialized) {\n                        module.initialized = true;\n                        try {\n                            initFunc(api, module);\n                            module.supported = true;\n                        } catch (ex) {\n                            var errorMessage = \"Module '\" + name + \"' failed to load: \" + getErrorDesc(ex);\n                            consoleLog(errorMessage);\n                        }\n                    }\n                });\n                modules[name] = newModule;\n            }\n            api.createModule = function(name) {\n                var initFunc, dependencies;\n                if (arguments.length == 2) {\n                    initFunc = arguments[1];\n                    dependencies = [];\n                } else {\n                    initFunc = arguments[2];\n                    dependencies = arguments[1];\n                }\n                createModule(false, name, dependencies, initFunc);\n            };\n            api.createCoreModule = function(name, dependencies, initFunc) {\n                createModule(true, name, dependencies, initFunc);\n            };\n            function RangePrototype() {}\n            api.RangePrototype = RangePrototype;\n            api.rangePrototype = new RangePrototype();\n            function SelectionPrototype() {}\n            api.selectionPrototype = new SelectionPrototype();\n            exports.api = api;\n        }, {} ],\n        12: [ function(_dereq_, module, exports) {\n            var rangy = _dereq_(\"./core\");\n            rangy.api.createCoreModule(\"DomUtil\", [], function(api, module) {\n                var UNDEF = \"undefined\";\n                var util = api.util;\n                if (!util.areHostMethods(document, [ \"createDocumentFragment\", \"createElement\", \"createTextNode\" ])) {\n                    module.fail(\"document missing a Node creation method\");\n                }\n                if (!util.isHostMethod(document, \"getElementsByTagName\")) {\n                    module.fail(\"document missing getElementsByTagName method\");\n                }\n                var el = document.createElement(\"div\");\n                if (!util.areHostMethods(el, [ \"insertBefore\", \"appendChild\", \"cloneNode\" ] || !util.areHostObjects(el, [ \"previousSibling\", \"nextSibling\", \"childNodes\", \"parentNode\" ]))) {\n                    module.fail(\"Incomplete Element implementation\");\n                }\n                if (!util.isHostProperty(el, \"innerHTML\")) {\n                    module.fail(\"Element is missing innerHTML property\");\n                }\n                var textNode = document.createTextNode(\"test\");\n                if (!util.areHostMethods(textNode, [ \"splitText\", \"deleteData\", \"insertData\", \"appendData\", \"cloneNode\" ] || !util.areHostObjects(el, [ \"previousSibling\", \"nextSibling\", \"childNodes\", \"parentNode\" ]) || !util.areHostProperties(textNode, [ \"data\" ]))) {\n                    module.fail(\"Incomplete Text Node implementation\");\n                }\n                var arrayContains = function(arr, val) {\n                    var i = arr.length;\n                    while (i--) {\n                        if (arr[i] === val) {\n                            return true;\n                        }\n                    }\n                    return false;\n                };\n                function isHtmlNamespace(node) {\n                    var ns;\n                    return typeof node.namespaceURI == UNDEF || ((ns = node.namespaceURI) === null || ns == \"http://www.w3.org/1999/xhtml\");\n                }\n                function parentElement(node) {\n                    var parent = node.parentNode;\n                    return parent.nodeType == 1 ? parent : null;\n                }\n                function getNodeIndex(node) {\n                    var i = 0;\n                    while (node = node.previousSibling) {\n                        ++i;\n                    }\n                    return i;\n                }\n                function getNodeLength(node) {\n                    switch (node.nodeType) {\n                      case 7:\n                      case 10:\n                        return 0;\n\n                      case 3:\n                      case 8:\n                        return node.length;\n\n                      default:\n                        return node.childNodes.length;\n                    }\n                }\n                function getCommonAncestor(node1, node2) {\n                    var ancestors = [], n;\n                    for (n = node1; n; n = n.parentNode) {\n                        ancestors.push(n);\n                    }\n                    for (n = node2; n; n = n.parentNode) {\n                        if (arrayContains(ancestors, n)) {\n                            return n;\n                        }\n                    }\n                    return null;\n                }\n                function isAncestorOf(ancestor, descendant, selfIsAncestor) {\n                    var n = selfIsAncestor ? descendant : descendant.parentNode;\n                    while (n) {\n                        if (n === ancestor) {\n                            return true;\n                        } else {\n                            n = n.parentNode;\n                        }\n                    }\n                    return false;\n                }\n                function isOrIsAncestorOf(ancestor, descendant) {\n                    return isAncestorOf(ancestor, descendant, true);\n                }\n                function getClosestAncestorIn(node, ancestor, selfIsAncestor) {\n                    var p, n = selfIsAncestor ? node : node.parentNode;\n                    while (n) {\n                        p = n.parentNode;\n                        if (p === ancestor) {\n                            return n;\n                        }\n                        n = p;\n                    }\n                    return null;\n                }\n                function isCharacterDataNode(node) {\n                    var t = node.nodeType;\n                    return t == 3 || t == 4 || t == 8;\n                }\n                function isTextOrCommentNode(node) {\n                    if (!node) {\n                        return false;\n                    }\n                    var t = node.nodeType;\n                    return t == 3 || t == 8;\n                }\n                function insertAfter(node, precedingNode) {\n                    var nextNode = precedingNode.nextSibling, parent = precedingNode.parentNode;\n                    if (nextNode) {\n                        parent.insertBefore(node, nextNode);\n                    } else {\n                        parent.appendChild(node);\n                    }\n                    return node;\n                }\n                function splitDataNode(node, index, positionsToPreserve) {\n                    var newNode = node.cloneNode(false);\n                    newNode.deleteData(0, index);\n                    node.deleteData(index, node.length - index);\n                    insertAfter(newNode, node);\n                    if (positionsToPreserve) {\n                        for (var i = 0, position; position = positionsToPreserve[i++]; ) {\n                            if (position.node == node && position.offset > index) {\n                                position.node = newNode;\n                                position.offset -= index;\n                            } else if (position.node == node.parentNode && position.offset > getNodeIndex(node)) {\n                                ++position.offset;\n                            }\n                        }\n                    }\n                    return newNode;\n                }\n                function getDocument(node) {\n                    if (node.nodeType == 9) {\n                        return node;\n                    } else if (typeof node.ownerDocument != UNDEF) {\n                        return node.ownerDocument;\n                    } else if (typeof node.document != UNDEF) {\n                        return node.document;\n                    } else if (node.parentNode) {\n                        return getDocument(node.parentNode);\n                    } else {\n                        throw module.createError(\"getDocument: no document found for node\");\n                    }\n                }\n                function getWindow(node) {\n                    var doc = getDocument(node);\n                    if (typeof doc.defaultView != UNDEF) {\n                        return doc.defaultView;\n                    } else if (typeof doc.parentWindow != UNDEF) {\n                        return doc.parentWindow;\n                    } else {\n                        throw module.createError(\"Cannot get a window object for node\");\n                    }\n                }\n                function getIframeDocument(iframeEl) {\n                    if (typeof iframeEl.contentDocument != UNDEF) {\n                        return iframeEl.contentDocument;\n                    } else if (typeof iframeEl.contentWindow != UNDEF) {\n                        return iframeEl.contentWindow.document;\n                    } else {\n                        throw module.createError(\"getIframeDocument: No Document object found for iframe element\");\n                    }\n                }\n                function getIframeWindow(iframeEl) {\n                    if (typeof iframeEl.contentWindow != UNDEF) {\n                        return iframeEl.contentWindow;\n                    } else if (typeof iframeEl.contentDocument != UNDEF) {\n                        return iframeEl.contentDocument.defaultView;\n                    } else {\n                        throw module.createError(\"getIframeWindow: No Window object found for iframe element\");\n                    }\n                }\n                function isWindow(obj) {\n                    return obj && util.isHostMethod(obj, \"setTimeout\") && util.isHostObject(obj, \"document\");\n                }\n                function getContentDocument(obj, module, methodName) {\n                    var doc;\n                    if (!obj) {\n                        doc = document;\n                    } else if (util.isHostProperty(obj, \"nodeType\")) {\n                        doc = obj.nodeType == 1 && obj.tagName.toLowerCase() == \"iframe\" ? getIframeDocument(obj) : getDocument(obj);\n                    } else if (isWindow(obj)) {\n                        doc = obj.document;\n                    }\n                    if (!doc) {\n                        throw module.createError(methodName + \"(): Parameter must be a Window object or DOM node\");\n                    }\n                    return doc;\n                }\n                function getRootContainer(node) {\n                    var parent;\n                    while (parent = node.parentNode) {\n                        node = parent;\n                    }\n                    return node;\n                }\n                function comparePoints(nodeA, offsetA, nodeB, offsetB) {\n                    var nodeC, root, childA, childB, n;\n                    if (nodeA == nodeB) {\n                        return offsetA === offsetB ? 0 : offsetA < offsetB ? -1 : 1;\n                    } else if (nodeC = getClosestAncestorIn(nodeB, nodeA, true)) {\n                        return offsetA <= getNodeIndex(nodeC) ? -1 : 1;\n                    } else if (nodeC = getClosestAncestorIn(nodeA, nodeB, true)) {\n                        return getNodeIndex(nodeC) < offsetB ? -1 : 1;\n                    } else {\n                        root = getCommonAncestor(nodeA, nodeB);\n                        if (!root) {\n                            throw new Error(\"comparePoints error: nodes have no common ancestor\");\n                        }\n                        childA = nodeA === root ? root : getClosestAncestorIn(nodeA, root, true);\n                        childB = nodeB === root ? root : getClosestAncestorIn(nodeB, root, true);\n                        if (childA === childB) {\n                            throw module.createError(\"comparePoints got to case 4 and childA and childB are the same!\");\n                        } else {\n                            n = root.firstChild;\n                            while (n) {\n                                if (n === childA) {\n                                    return -1;\n                                } else if (n === childB) {\n                                    return 1;\n                                }\n                                n = n.nextSibling;\n                            }\n                        }\n                    }\n                }\n                var crashyTextNodes = false;\n                function isBrokenNode(node) {\n                    try {\n                        node.parentNode;\n                        return false;\n                    } catch (e) {\n                        return true;\n                    }\n                }\n                (function() {\n                    var el = document.createElement(\"b\");\n                    el.innerHTML = \"1\";\n                    var textNode = el.firstChild;\n                    el.innerHTML = \"<br>\";\n                    crashyTextNodes = isBrokenNode(textNode);\n                    api.features.crashyTextNodes = crashyTextNodes;\n                })();\n                function inspectNode(node) {\n                    if (!node) {\n                        return \"[No node]\";\n                    }\n                    if (crashyTextNodes && isBrokenNode(node)) {\n                        return \"[Broken node]\";\n                    }\n                    if (isCharacterDataNode(node)) {\n                        return '\"' + node.data + '\"';\n                    }\n                    if (node.nodeType == 1) {\n                        var idAttr = node.id ? ' id=\"' + node.id + '\"' : \"\";\n                        return \"<\" + node.nodeName + idAttr + \">[\" + getNodeIndex(node) + \"][\" + node.childNodes.length + \"][\" + (node.innerHTML || \"[innerHTML not supported]\").slice(0, 25) + \"]\";\n                    }\n                    return node.nodeName;\n                }\n                function fragmentFromNodeChildren(node) {\n                    var fragment = getDocument(node).createDocumentFragment(), child;\n                    while (child = node.firstChild) {\n                        fragment.appendChild(child);\n                    }\n                    return fragment;\n                }\n                var getComputedStyleProperty;\n                if (typeof window.getComputedStyle != UNDEF) {\n                    getComputedStyleProperty = function(el, propName) {\n                        return getWindow(el).getComputedStyle(el, null)[propName];\n                    };\n                } else if (typeof document.documentElement.currentStyle != UNDEF) {\n                    getComputedStyleProperty = function(el, propName) {\n                        return el.currentStyle[propName];\n                    };\n                } else {\n                    module.fail(\"No means of obtaining computed style properties found\");\n                }\n                function NodeIterator(root) {\n                    this.root = root;\n                    this._next = root;\n                }\n                NodeIterator.prototype = {\n                    _current: null,\n                    hasNext: function() {\n                        return !!this._next;\n                    },\n                    next: function() {\n                        var n = this._current = this._next;\n                        var child, next;\n                        if (this._current) {\n                            child = n.firstChild;\n                            if (child) {\n                                this._next = child;\n                            } else {\n                                next = null;\n                                while (n !== this.root && !(next = n.nextSibling)) {\n                                    n = n.parentNode;\n                                }\n                                this._next = next;\n                            }\n                        }\n                        return this._current;\n                    },\n                    detach: function() {\n                        this._current = this._next = this.root = null;\n                    }\n                };\n                function createIterator(root) {\n                    return new NodeIterator(root);\n                }\n                function DomPosition(node, offset) {\n                    this.node = node;\n                    this.offset = offset;\n                }\n                DomPosition.prototype = {\n                    equals: function(pos) {\n                        return !!pos && this.node === pos.node && this.offset == pos.offset;\n                    },\n                    inspect: function() {\n                        return \"[DomPosition(\" + inspectNode(this.node) + \":\" + this.offset + \")]\";\n                    },\n                    toString: function() {\n                        return this.inspect();\n                    }\n                };\n                function DOMException(codeName) {\n                    this.code = this[codeName];\n                    this.codeName = codeName;\n                    this.message = \"DOMException: \" + this.codeName;\n                }\n                DOMException.prototype = {\n                    INDEX_SIZE_ERR: 1,\n                    HIERARCHY_REQUEST_ERR: 3,\n                    WRONG_DOCUMENT_ERR: 4,\n                    NO_MODIFICATION_ALLOWED_ERR: 7,\n                    NOT_FOUND_ERR: 8,\n                    NOT_SUPPORTED_ERR: 9,\n                    INVALID_STATE_ERR: 11\n                };\n                DOMException.prototype.toString = function() {\n                    return this.message;\n                };\n                api.dom = {\n                    arrayContains: arrayContains,\n                    isHtmlNamespace: isHtmlNamespace,\n                    parentElement: parentElement,\n                    getNodeIndex: getNodeIndex,\n                    getNodeLength: getNodeLength,\n                    getCommonAncestor: getCommonAncestor,\n                    isAncestorOf: isAncestorOf,\n                    isOrIsAncestorOf: isOrIsAncestorOf,\n                    getClosestAncestorIn: getClosestAncestorIn,\n                    isCharacterDataNode: isCharacterDataNode,\n                    isTextOrCommentNode: isTextOrCommentNode,\n                    insertAfter: insertAfter,\n                    splitDataNode: splitDataNode,\n                    getDocument: getDocument,\n                    getWindow: getWindow,\n                    getIframeWindow: getIframeWindow,\n                    getIframeDocument: getIframeDocument,\n                    getBody: util.getBody,\n                    isWindow: isWindow,\n                    getContentDocument: getContentDocument,\n                    getRootContainer: getRootContainer,\n                    comparePoints: comparePoints,\n                    isBrokenNode: isBrokenNode,\n                    inspectNode: inspectNode,\n                    getComputedStyleProperty: getComputedStyleProperty,\n                    fragmentFromNodeChildren: fragmentFromNodeChildren,\n                    createIterator: createIterator,\n                    DomPosition: DomPosition\n                };\n                api.DOMException = DOMException;\n            });\n        }, {\n            \"./core\": 11\n        } ],\n        13: [ function(_dereq_, module, exports) {\n            var rangy = _dereq_(\"./core\");\n            rangy.api.createCoreModule(\"DomRange\", [ \"DomUtil\" ], function(api, module) {\n                var dom = api.dom;\n                var util = api.util;\n                var DomPosition = dom.DomPosition;\n                var DOMException = api.DOMException;\n                var isCharacterDataNode = dom.isCharacterDataNode;\n                var getNodeIndex = dom.getNodeIndex;\n                var isOrIsAncestorOf = dom.isOrIsAncestorOf;\n                var getDocument = dom.getDocument;\n                var comparePoints = dom.comparePoints;\n                var splitDataNode = dom.splitDataNode;\n                var getClosestAncestorIn = dom.getClosestAncestorIn;\n                var getNodeLength = dom.getNodeLength;\n                var arrayContains = dom.arrayContains;\n                var getRootContainer = dom.getRootContainer;\n                var crashyTextNodes = api.features.crashyTextNodes;\n                function isNonTextPartiallySelected(node, range) {\n                    return node.nodeType != 3 && (isOrIsAncestorOf(node, range.startContainer) || isOrIsAncestorOf(node, range.endContainer));\n                }\n                function getRangeDocument(range) {\n                    return range.document || getDocument(range.startContainer);\n                }\n                function getBoundaryBeforeNode(node) {\n                    return new DomPosition(node.parentNode, getNodeIndex(node));\n                }\n                function getBoundaryAfterNode(node) {\n                    return new DomPosition(node.parentNode, getNodeIndex(node) + 1);\n                }\n                function insertNodeAtPosition(node, n, o) {\n                    var firstNodeInserted = node.nodeType == 11 ? node.firstChild : node;\n                    if (isCharacterDataNode(n)) {\n                        if (o == n.length) {\n                            dom.insertAfter(node, n);\n                        } else {\n                            n.parentNode.insertBefore(node, o == 0 ? n : splitDataNode(n, o));\n                        }\n                    } else if (o >= n.childNodes.length) {\n                        n.appendChild(node);\n                    } else {\n                        n.insertBefore(node, n.childNodes[o]);\n                    }\n                    return firstNodeInserted;\n                }\n                function rangesIntersect(rangeA, rangeB, touchingIsIntersecting) {\n                    assertRangeValid(rangeA);\n                    assertRangeValid(rangeB);\n                    if (getRangeDocument(rangeB) != getRangeDocument(rangeA)) {\n                        throw new DOMException(\"WRONG_DOCUMENT_ERR\");\n                    }\n                    var startComparison = comparePoints(rangeA.startContainer, rangeA.startOffset, rangeB.endContainer, rangeB.endOffset), endComparison = comparePoints(rangeA.endContainer, rangeA.endOffset, rangeB.startContainer, rangeB.startOffset);\n                    return touchingIsIntersecting ? startComparison <= 0 && endComparison >= 0 : startComparison < 0 && endComparison > 0;\n                }\n                function cloneSubtree(iterator) {\n                    var partiallySelected;\n                    for (var node, frag = getRangeDocument(iterator.range).createDocumentFragment(), subIterator; node = iterator.next(); ) {\n                        partiallySelected = iterator.isPartiallySelectedSubtree();\n                        node = node.cloneNode(!partiallySelected);\n                        if (partiallySelected) {\n                            subIterator = iterator.getSubtreeIterator();\n                            node.appendChild(cloneSubtree(subIterator));\n                            subIterator.detach(true);\n                        }\n                        if (node.nodeType == 10) {\n                            throw new DOMException(\"HIERARCHY_REQUEST_ERR\");\n                        }\n                        frag.appendChild(node);\n                    }\n                    return frag;\n                }\n                function iterateSubtree(rangeIterator, func, iteratorState) {\n                    var it, n;\n                    iteratorState = iteratorState || {\n                        stop: false\n                    };\n                    for (var node, subRangeIterator; node = rangeIterator.next(); ) {\n                        if (rangeIterator.isPartiallySelectedSubtree()) {\n                            if (func(node) === false) {\n                                iteratorState.stop = true;\n                                return;\n                            } else {\n                                subRangeIterator = rangeIterator.getSubtreeIterator();\n                                iterateSubtree(subRangeIterator, func, iteratorState);\n                                subRangeIterator.detach(true);\n                                if (iteratorState.stop) {\n                                    return;\n                                }\n                            }\n                        } else {\n                            it = dom.createIterator(node);\n                            while (n = it.next()) {\n                                if (func(n) === false) {\n                                    iteratorState.stop = true;\n                                    return;\n                                }\n                            }\n                        }\n                    }\n                }\n                function deleteSubtree(iterator) {\n                    var subIterator;\n                    while (iterator.next()) {\n                        if (iterator.isPartiallySelectedSubtree()) {\n                            subIterator = iterator.getSubtreeIterator();\n                            deleteSubtree(subIterator);\n                            subIterator.detach(true);\n                        } else {\n                            iterator.remove();\n                        }\n                    }\n                }\n                function extractSubtree(iterator) {\n                    for (var node, frag = getRangeDocument(iterator.range).createDocumentFragment(), subIterator; node = iterator.next(); ) {\n                        if (iterator.isPartiallySelectedSubtree()) {\n                            node = node.cloneNode(false);\n                            subIterator = iterator.getSubtreeIterator();\n                            node.appendChild(extractSubtree(subIterator));\n                            subIterator.detach(true);\n                        } else {\n                            iterator.remove();\n                        }\n                        if (node.nodeType == 10) {\n                            throw new DOMException(\"HIERARCHY_REQUEST_ERR\");\n                        }\n                        frag.appendChild(node);\n                    }\n                    return frag;\n                }\n                function getNodesInRange(range, nodeTypes, filter) {\n                    var filterNodeTypes = !!(nodeTypes && nodeTypes.length), regex;\n                    var filterExists = !!filter;\n                    if (filterNodeTypes) {\n                        regex = new RegExp(\"^(\" + nodeTypes.join(\"|\") + \")$\");\n                    }\n                    var nodes = [];\n                    iterateSubtree(new RangeIterator(range, false), function(node) {\n                        if (filterNodeTypes && !regex.test(node.nodeType)) {\n                            return;\n                        }\n                        if (filterExists && !filter(node)) {\n                            return;\n                        }\n                        var sc = range.startContainer;\n                        if (node == sc && isCharacterDataNode(sc) && range.startOffset == sc.length) {\n                            return;\n                        }\n                        var ec = range.endContainer;\n                        if (node == ec && isCharacterDataNode(ec) && range.endOffset == 0) {\n                            return;\n                        }\n                        nodes.push(node);\n                    });\n                    return nodes;\n                }\n                function inspect(range) {\n                    var name = typeof range.getName == \"undefined\" ? \"Range\" : range.getName();\n                    return \"[\" + name + \"(\" + dom.inspectNode(range.startContainer) + \":\" + range.startOffset + \", \" + dom.inspectNode(range.endContainer) + \":\" + range.endOffset + \")]\";\n                }\n                function RangeIterator(range, clonePartiallySelectedTextNodes) {\n                    this.range = range;\n                    this.clonePartiallySelectedTextNodes = clonePartiallySelectedTextNodes;\n                    if (!range.collapsed) {\n                        this.sc = range.startContainer;\n                        this.so = range.startOffset;\n                        this.ec = range.endContainer;\n                        this.eo = range.endOffset;\n                        var root = range.commonAncestorContainer;\n                        if (this.sc === this.ec && isCharacterDataNode(this.sc)) {\n                            this.isSingleCharacterDataNode = true;\n                            this._first = this._last = this._next = this.sc;\n                        } else {\n                            this._first = this._next = this.sc === root && !isCharacterDataNode(this.sc) ? this.sc.childNodes[this.so] : getClosestAncestorIn(this.sc, root, true);\n                            this._last = this.ec === root && !isCharacterDataNode(this.ec) ? this.ec.childNodes[this.eo - 1] : getClosestAncestorIn(this.ec, root, true);\n                        }\n                    }\n                }\n                RangeIterator.prototype = {\n                    _current: null,\n                    _next: null,\n                    _first: null,\n                    _last: null,\n                    isSingleCharacterDataNode: false,\n                    reset: function() {\n                        this._current = null;\n                        this._next = this._first;\n                    },\n                    hasNext: function() {\n                        return !!this._next;\n                    },\n                    next: function() {\n                        var current = this._current = this._next;\n                        if (current) {\n                            this._next = current !== this._last ? current.nextSibling : null;\n                            if (isCharacterDataNode(current) && this.clonePartiallySelectedTextNodes) {\n                                if (current === this.ec) {\n                                    (current = current.cloneNode(true)).deleteData(this.eo, current.length - this.eo);\n                                }\n                                if (this._current === this.sc) {\n                                    (current = current.cloneNode(true)).deleteData(0, this.so);\n                                }\n                            }\n                        }\n                        return current;\n                    },\n                    remove: function() {\n                        var current = this._current, start, end;\n                        if (isCharacterDataNode(current) && (current === this.sc || current === this.ec)) {\n                            start = current === this.sc ? this.so : 0;\n                            end = current === this.ec ? this.eo : current.length;\n                            if (start != end) {\n                                current.deleteData(start, end - start);\n                            }\n                        } else {\n                            if (current.parentNode) {\n                                current.parentNode.removeChild(current);\n                            } else {}\n                        }\n                    },\n                    isPartiallySelectedSubtree: function() {\n                        var current = this._current;\n                        return isNonTextPartiallySelected(current, this.range);\n                    },\n                    getSubtreeIterator: function() {\n                        var subRange;\n                        if (this.isSingleCharacterDataNode) {\n                            subRange = this.range.cloneRange();\n                            subRange.collapse(false);\n                        } else {\n                            subRange = new Range(getRangeDocument(this.range));\n                            var current = this._current;\n                            var startContainer = current, startOffset = 0, endContainer = current, endOffset = getNodeLength(current);\n                            if (isOrIsAncestorOf(current, this.sc)) {\n                                startContainer = this.sc;\n                                startOffset = this.so;\n                            }\n                            if (isOrIsAncestorOf(current, this.ec)) {\n                                endContainer = this.ec;\n                                endOffset = this.eo;\n                            }\n                            updateBoundaries(subRange, startContainer, startOffset, endContainer, endOffset);\n                        }\n                        return new RangeIterator(subRange, this.clonePartiallySelectedTextNodes);\n                    },\n                    detach: function(detachRange) {\n                        if (detachRange) {\n                            this.range.detach();\n                        }\n                        this.range = this._current = this._next = this._first = this._last = this.sc = this.so = this.ec = this.eo = null;\n                    }\n                };\n                function RangeException(codeName) {\n                    this.code = this[codeName];\n                    this.codeName = codeName;\n                    this.message = \"RangeException: \" + this.codeName;\n                }\n                RangeException.prototype = {\n                    BAD_BOUNDARYPOINTS_ERR: 1,\n                    INVALID_NODE_TYPE_ERR: 2\n                };\n                RangeException.prototype.toString = function() {\n                    return this.message;\n                };\n                var beforeAfterNodeTypes = [ 1, 3, 4, 5, 7, 8, 10 ];\n                var rootContainerNodeTypes = [ 2, 9, 11 ];\n                var readonlyNodeTypes = [ 5, 6, 10, 12 ];\n                var insertableNodeTypes = [ 1, 3, 4, 5, 7, 8, 10, 11 ];\n                var surroundNodeTypes = [ 1, 3, 4, 5, 7, 8 ];\n                function createAncestorFinder(nodeTypes) {\n                    return function(node, selfIsAncestor) {\n                        var t, n = selfIsAncestor ? node : node.parentNode;\n                        while (n) {\n                            t = n.nodeType;\n                            if (arrayContains(nodeTypes, t)) {\n                                return n;\n                            }\n                            n = n.parentNode;\n                        }\n                        return null;\n                    };\n                }\n                var getDocumentOrFragmentContainer = createAncestorFinder([ 9, 11 ]);\n                var getReadonlyAncestor = createAncestorFinder(readonlyNodeTypes);\n                var getDocTypeNotationEntityAncestor = createAncestorFinder([ 6, 10, 12 ]);\n                function assertNoDocTypeNotationEntityAncestor(node, allowSelf) {\n                    if (getDocTypeNotationEntityAncestor(node, allowSelf)) {\n                        throw new RangeException(\"INVALID_NODE_TYPE_ERR\");\n                    }\n                }\n                function assertNotDetached(range) {\n                    if (!range.startContainer) {\n                        throw new DOMException(\"INVALID_STATE_ERR\");\n                    }\n                }\n                function assertValidNodeType(node, invalidTypes) {\n                    if (!arrayContains(invalidTypes, node.nodeType)) {\n                        throw new RangeException(\"INVALID_NODE_TYPE_ERR\");\n                    }\n                }\n                function assertValidOffset(node, offset) {\n                    if (offset < 0 || offset > (isCharacterDataNode(node) ? node.length : node.childNodes.length)) {\n                        throw new DOMException(\"INDEX_SIZE_ERR\");\n                    }\n                }\n                function assertSameDocumentOrFragment(node1, node2) {\n                    if (getDocumentOrFragmentContainer(node1, true) !== getDocumentOrFragmentContainer(node2, true)) {\n                        throw new DOMException(\"WRONG_DOCUMENT_ERR\");\n                    }\n                }\n                function assertNodeNotReadOnly(node) {\n                    if (getReadonlyAncestor(node, true)) {\n                        throw new DOMException(\"NO_MODIFICATION_ALLOWED_ERR\");\n                    }\n                }\n                function assertNode(node, codeName) {\n                    if (!node) {\n                        throw new DOMException(codeName);\n                    }\n                }\n                function isOrphan(node) {\n                    return crashyTextNodes && dom.isBrokenNode(node) || !arrayContains(rootContainerNodeTypes, node.nodeType) && !getDocumentOrFragmentContainer(node, true);\n                }\n                function isValidOffset(node, offset) {\n                    return offset <= (isCharacterDataNode(node) ? node.length : node.childNodes.length);\n                }\n                function isRangeValid(range) {\n                    return !!range.startContainer && !!range.endContainer && !isOrphan(range.startContainer) && !isOrphan(range.endContainer) && isValidOffset(range.startContainer, range.startOffset) && isValidOffset(range.endContainer, range.endOffset);\n                }\n                function assertRangeValid(range) {\n                    assertNotDetached(range);\n                    if (!isRangeValid(range)) {\n                        throw new Error(\"Range error: Range is no longer valid after DOM mutation (\" + range.inspect() + \")\");\n                    }\n                }\n                var styleEl = document.createElement(\"style\");\n                var htmlParsingConforms = false;\n                try {\n                    styleEl.innerHTML = \"<b>x</b>\";\n                    htmlParsingConforms = styleEl.firstChild.nodeType == 3;\n                } catch (e) {}\n                api.features.htmlParsingConforms = htmlParsingConforms;\n                var createContextualFragment = htmlParsingConforms ? function(fragmentStr) {\n                    var node = this.startContainer;\n                    var doc = getDocument(node);\n                    if (!node) {\n                        throw new DOMException(\"INVALID_STATE_ERR\");\n                    }\n                    var el = null;\n                    if (node.nodeType == 1) {\n                        el = node;\n                    } else if (isCharacterDataNode(node)) {\n                        el = dom.parentElement(node);\n                    }\n                    if (el === null || el.nodeName == \"HTML\" && dom.isHtmlNamespace(getDocument(el).documentElement) && dom.isHtmlNamespace(el)) {\n                        el = doc.createElement(\"body\");\n                    } else {\n                        el = el.cloneNode(false);\n                    }\n                    el.innerHTML = fragmentStr;\n                    return dom.fragmentFromNodeChildren(el);\n                } : function(fragmentStr) {\n                    assertNotDetached(this);\n                    var doc = getRangeDocument(this);\n                    var el = doc.createElement(\"body\");\n                    el.innerHTML = fragmentStr;\n                    return dom.fragmentFromNodeChildren(el);\n                };\n                function splitRangeBoundaries(range, positionsToPreserve) {\n                    assertRangeValid(range);\n                    var sc = range.startContainer, so = range.startOffset, ec = range.endContainer, eo = range.endOffset;\n                    var startEndSame = sc === ec;\n                    if (isCharacterDataNode(ec) && eo > 0 && eo < ec.length) {\n                        splitDataNode(ec, eo, positionsToPreserve);\n                    }\n                    if (isCharacterDataNode(sc) && so > 0 && so < sc.length) {\n                        sc = splitDataNode(sc, so, positionsToPreserve);\n                        if (startEndSame) {\n                            eo -= so;\n                            ec = sc;\n                        } else if (ec == sc.parentNode && eo >= getNodeIndex(sc)) {\n                            eo++;\n                        }\n                        so = 0;\n                    }\n                    range.setStartAndEnd(sc, so, ec, eo);\n                }\n                var rangeProperties = [ \"startContainer\", \"startOffset\", \"endContainer\", \"endOffset\", \"collapsed\", \"commonAncestorContainer\" ];\n                var s2s = 0, s2e = 1, e2e = 2, e2s = 3;\n                var n_b = 0, n_a = 1, n_b_a = 2, n_i = 3;\n                util.extend(api.rangePrototype, {\n                    compareBoundaryPoints: function(how, range) {\n                        assertRangeValid(this);\n                        assertSameDocumentOrFragment(this.startContainer, range.startContainer);\n                        var nodeA, offsetA, nodeB, offsetB;\n                        var prefixA = how == e2s || how == s2s ? \"start\" : \"end\";\n                        var prefixB = how == s2e || how == s2s ? \"start\" : \"end\";\n                        nodeA = this[prefixA + \"Container\"];\n                        offsetA = this[prefixA + \"Offset\"];\n                        nodeB = range[prefixB + \"Container\"];\n                        offsetB = range[prefixB + \"Offset\"];\n                        return comparePoints(nodeA, offsetA, nodeB, offsetB);\n                    },\n                    insertNode: function(node) {\n                        assertRangeValid(this);\n                        assertValidNodeType(node, insertableNodeTypes);\n                        assertNodeNotReadOnly(this.startContainer);\n                        if (isOrIsAncestorOf(node, this.startContainer)) {\n                            throw new DOMException(\"HIERARCHY_REQUEST_ERR\");\n                        }\n                        var firstNodeInserted = insertNodeAtPosition(node, this.startContainer, this.startOffset);\n                        this.setStartBefore(firstNodeInserted);\n                    },\n                    cloneContents: function() {\n                        assertRangeValid(this);\n                        var clone, frag;\n                        if (this.collapsed) {\n                            return getRangeDocument(this).createDocumentFragment();\n                        } else {\n                            if (this.startContainer === this.endContainer && isCharacterDataNode(this.startContainer)) {\n                                clone = this.startContainer.cloneNode(true);\n                                clone.data = clone.data.slice(this.startOffset, this.endOffset);\n                                frag = getRangeDocument(this).createDocumentFragment();\n                                frag.appendChild(clone);\n                                return frag;\n                            } else {\n                                var iterator = new RangeIterator(this, true);\n                                clone = cloneSubtree(iterator);\n                                iterator.detach();\n                            }\n                            return clone;\n                        }\n                    },\n                    canSurroundContents: function() {\n                        assertRangeValid(this);\n                        assertNodeNotReadOnly(this.startContainer);\n                        assertNodeNotReadOnly(this.endContainer);\n                        var iterator = new RangeIterator(this, true);\n                        var boundariesInvalid = iterator._first && isNonTextPartiallySelected(iterator._first, this) || iterator._last && isNonTextPartiallySelected(iterator._last, this);\n                        iterator.detach();\n                        return !boundariesInvalid;\n                    },\n                    surroundContents: function(node) {\n                        assertValidNodeType(node, surroundNodeTypes);\n                        if (!this.canSurroundContents()) {\n                            throw new RangeException(\"BAD_BOUNDARYPOINTS_ERR\");\n                        }\n                        var content = this.extractContents();\n                        if (node.hasChildNodes()) {\n                            while (node.lastChild) {\n                                node.removeChild(node.lastChild);\n                            }\n                        }\n                        insertNodeAtPosition(node, this.startContainer, this.startOffset);\n                        node.appendChild(content);\n                        this.selectNode(node);\n                    },\n                    cloneRange: function() {\n                        assertRangeValid(this);\n                        var range = new Range(getRangeDocument(this));\n                        var i = rangeProperties.length, prop;\n                        while (i--) {\n                            prop = rangeProperties[i];\n                            range[prop] = this[prop];\n                        }\n                        return range;\n                    },\n                    toString: function() {\n                        assertRangeValid(this);\n                        var sc = this.startContainer;\n                        if (sc === this.endContainer && isCharacterDataNode(sc)) {\n                            return sc.nodeType == 3 || sc.nodeType == 4 ? sc.data.slice(this.startOffset, this.endOffset) : \"\";\n                        } else {\n                            var textParts = [], iterator = new RangeIterator(this, true);\n                            iterateSubtree(iterator, function(node) {\n                                if (node.nodeType == 3 || node.nodeType == 4) {\n                                    textParts.push(node.data);\n                                }\n                            });\n                            iterator.detach();\n                            return textParts.join(\"\");\n                        }\n                    },\n                    compareNode: function(node) {\n                        assertRangeValid(this);\n                        var parent = node.parentNode;\n                        var nodeIndex = getNodeIndex(node);\n                        if (!parent) {\n                            throw new DOMException(\"NOT_FOUND_ERR\");\n                        }\n                        var startComparison = this.comparePoint(parent, nodeIndex), endComparison = this.comparePoint(parent, nodeIndex + 1);\n                        if (startComparison < 0) {\n                            return endComparison > 0 ? n_b_a : n_b;\n                        } else {\n                            return endComparison > 0 ? n_a : n_i;\n                        }\n                    },\n                    comparePoint: function(node, offset) {\n                        assertRangeValid(this);\n                        assertNode(node, \"HIERARCHY_REQUEST_ERR\");\n                        assertSameDocumentOrFragment(node, this.startContainer);\n                        if (comparePoints(node, offset, this.startContainer, this.startOffset) < 0) {\n                            return -1;\n                        } else if (comparePoints(node, offset, this.endContainer, this.endOffset) > 0) {\n                            return 1;\n                        }\n                        return 0;\n                    },\n                    createContextualFragment: createContextualFragment,\n                    toHtml: function() {\n                        assertRangeValid(this);\n                        var container = this.commonAncestorContainer.parentNode.cloneNode(false);\n                        container.appendChild(this.cloneContents());\n                        return container.innerHTML;\n                    },\n                    intersectsNode: function(node, touchingIsIntersecting) {\n                        assertRangeValid(this);\n                        assertNode(node, \"NOT_FOUND_ERR\");\n                        if (getDocument(node) !== getRangeDocument(this)) {\n                            return false;\n                        }\n                        var parent = node.parentNode, offset = getNodeIndex(node);\n                        assertNode(parent, \"NOT_FOUND_ERR\");\n                        var startComparison = comparePoints(parent, offset, this.endContainer, this.endOffset), endComparison = comparePoints(parent, offset + 1, this.startContainer, this.startOffset);\n                        return touchingIsIntersecting ? startComparison <= 0 && endComparison >= 0 : startComparison < 0 && endComparison > 0;\n                    },\n                    isPointInRange: function(node, offset) {\n                        assertRangeValid(this);\n                        assertNode(node, \"HIERARCHY_REQUEST_ERR\");\n                        assertSameDocumentOrFragment(node, this.startContainer);\n                        return comparePoints(node, offset, this.startContainer, this.startOffset) >= 0 && comparePoints(node, offset, this.endContainer, this.endOffset) <= 0;\n                    },\n                    intersectsRange: function(range) {\n                        return rangesIntersect(this, range, false);\n                    },\n                    intersectsOrTouchesRange: function(range) {\n                        return rangesIntersect(this, range, true);\n                    },\n                    intersection: function(range) {\n                        if (this.intersectsRange(range)) {\n                            var startComparison = comparePoints(this.startContainer, this.startOffset, range.startContainer, range.startOffset), endComparison = comparePoints(this.endContainer, this.endOffset, range.endContainer, range.endOffset);\n                            var intersectionRange = this.cloneRange();\n                            if (startComparison == -1) {\n                                intersectionRange.setStart(range.startContainer, range.startOffset);\n                            }\n                            if (endComparison == 1) {\n                                intersectionRange.setEnd(range.endContainer, range.endOffset);\n                            }\n                            return intersectionRange;\n                        }\n                        return null;\n                    },\n                    union: function(range) {\n                        if (this.intersectsOrTouchesRange(range)) {\n                            var unionRange = this.cloneRange();\n                            if (comparePoints(range.startContainer, range.startOffset, this.startContainer, this.startOffset) == -1) {\n                                unionRange.setStart(range.startContainer, range.startOffset);\n                            }\n                            if (comparePoints(range.endContainer, range.endOffset, this.endContainer, this.endOffset) == 1) {\n                                unionRange.setEnd(range.endContainer, range.endOffset);\n                            }\n                            return unionRange;\n                        } else {\n                            throw new RangeException(\"Ranges do not intersect\");\n                        }\n                    },\n                    containsNode: function(node, allowPartial) {\n                        if (allowPartial) {\n                            return this.intersectsNode(node, false);\n                        } else {\n                            return this.compareNode(node) == n_i;\n                        }\n                    },\n                    containsNodeContents: function(node) {\n                        return this.comparePoint(node, 0) >= 0 && this.comparePoint(node, getNodeLength(node)) <= 0;\n                    },\n                    containsRange: function(range) {\n                        var intersection = this.intersection(range);\n                        return intersection !== null && range.equals(intersection);\n                    },\n                    containsNodeText: function(node) {\n                        var nodeRange = this.cloneRange();\n                        nodeRange.selectNode(node);\n                        var textNodes = nodeRange.getNodes([ 3 ]);\n                        if (textNodes.length > 0) {\n                            nodeRange.setStart(textNodes[0], 0);\n                            var lastTextNode = textNodes.pop();\n                            nodeRange.setEnd(lastTextNode, lastTextNode.length);\n                            var contains = this.containsRange(nodeRange);\n                            nodeRange.detach();\n                            return contains;\n                        } else {\n                            return this.containsNodeContents(node);\n                        }\n                    },\n                    getNodes: function(nodeTypes, filter) {\n                        assertRangeValid(this);\n                        return getNodesInRange(this, nodeTypes, filter);\n                    },\n                    getDocument: function() {\n                        return getRangeDocument(this);\n                    },\n                    collapseBefore: function(node) {\n                        assertNotDetached(this);\n                        this.setEndBefore(node);\n                        this.collapse(false);\n                    },\n                    collapseAfter: function(node) {\n                        assertNotDetached(this);\n                        this.setStartAfter(node);\n                        this.collapse(true);\n                    },\n                    getBookmark: function(containerNode) {\n                        var doc = getRangeDocument(this);\n                        var preSelectionRange = api.createRange(doc);\n                        containerNode = containerNode || dom.getBody(doc);\n                        preSelectionRange.selectNodeContents(containerNode);\n                        var range = this.intersection(preSelectionRange);\n                        var start = 0, end = 0;\n                        if (range) {\n                            preSelectionRange.setEnd(range.startContainer, range.startOffset);\n                            start = preSelectionRange.toString().length;\n                            end = start + range.toString().length;\n                            preSelectionRange.detach();\n                        }\n                        return {\n                            start: start,\n                            end: end,\n                            containerNode: containerNode\n                        };\n                    },\n                    moveToBookmark: function(bookmark) {\n                        var containerNode = bookmark.containerNode;\n                        var charIndex = 0;\n                        this.setStart(containerNode, 0);\n                        this.collapse(true);\n                        var nodeStack = [ containerNode ], node, foundStart = false, stop = false;\n                        var nextCharIndex, i, childNodes;\n                        while (!stop && (node = nodeStack.pop())) {\n                            if (node.nodeType == 3) {\n                                nextCharIndex = charIndex + node.length;\n                                if (!foundStart && bookmark.start >= charIndex && bookmark.start <= nextCharIndex) {\n                                    this.setStart(node, bookmark.start - charIndex);\n                                    foundStart = true;\n                                }\n                                if (foundStart && bookmark.end >= charIndex && bookmark.end <= nextCharIndex) {\n                                    this.setEnd(node, bookmark.end - charIndex);\n                                    stop = true;\n                                }\n                                charIndex = nextCharIndex;\n                            } else {\n                                childNodes = node.childNodes;\n                                i = childNodes.length;\n                                while (i--) {\n                                    nodeStack.push(childNodes[i]);\n                                }\n                            }\n                        }\n                    },\n                    getName: function() {\n                        return \"DomRange\";\n                    },\n                    equals: function(range) {\n                        return Range.rangesEqual(this, range);\n                    },\n                    isValid: function() {\n                        return isRangeValid(this);\n                    },\n                    inspect: function() {\n                        return inspect(this);\n                    }\n                });\n                function copyComparisonConstantsToObject(obj) {\n                    obj.START_TO_START = s2s;\n                    obj.START_TO_END = s2e;\n                    obj.END_TO_END = e2e;\n                    obj.END_TO_START = e2s;\n                    obj.NODE_BEFORE = n_b;\n                    obj.NODE_AFTER = n_a;\n                    obj.NODE_BEFORE_AND_AFTER = n_b_a;\n                    obj.NODE_INSIDE = n_i;\n                }\n                function copyComparisonConstants(constructor) {\n                    copyComparisonConstantsToObject(constructor);\n                    copyComparisonConstantsToObject(constructor.prototype);\n                }\n                function createRangeContentRemover(remover, boundaryUpdater) {\n                    return function() {\n                        assertRangeValid(this);\n                        var sc = this.startContainer, so = this.startOffset, root = this.commonAncestorContainer;\n                        var iterator = new RangeIterator(this, true);\n                        var node, boundary;\n                        if (sc !== root) {\n                            node = getClosestAncestorIn(sc, root, true);\n                            boundary = getBoundaryAfterNode(node);\n                            sc = boundary.node;\n                            so = boundary.offset;\n                        }\n                        iterateSubtree(iterator, assertNodeNotReadOnly);\n                        iterator.reset();\n                        var returnValue = remover(iterator);\n                        iterator.detach();\n                        boundaryUpdater(this, sc, so, sc, so);\n                        return returnValue;\n                    };\n                }\n                function createPrototypeRange(constructor, boundaryUpdater, detacher) {\n                    function createBeforeAfterNodeSetter(isBefore, isStart) {\n                        return function(node) {\n                            assertNotDetached(this);\n                            assertValidNodeType(node, beforeAfterNodeTypes);\n                            assertValidNodeType(getRootContainer(node), rootContainerNodeTypes);\n                            var boundary = (isBefore ? getBoundaryBeforeNode : getBoundaryAfterNode)(node);\n                            (isStart ? setRangeStart : setRangeEnd)(this, boundary.node, boundary.offset);\n                        };\n                    }\n                    function setRangeStart(range, node, offset) {\n                        var ec = range.endContainer, eo = range.endOffset;\n                        if (node !== range.startContainer || offset !== range.startOffset) {\n                            if (getRootContainer(node) != getRootContainer(ec) || comparePoints(node, offset, ec, eo) == 1) {\n                                ec = node;\n                                eo = offset;\n                            }\n                            boundaryUpdater(range, node, offset, ec, eo);\n                        }\n                    }\n                    function setRangeEnd(range, node, offset) {\n                        var sc = range.startContainer, so = range.startOffset;\n                        if (node !== range.endContainer || offset !== range.endOffset) {\n                            if (getRootContainer(node) != getRootContainer(sc) || comparePoints(node, offset, sc, so) == -1) {\n                                sc = node;\n                                so = offset;\n                            }\n                            boundaryUpdater(range, sc, so, node, offset);\n                        }\n                    }\n                    var F = function() {};\n                    F.prototype = api.rangePrototype;\n                    constructor.prototype = new F();\n                    util.extend(constructor.prototype, {\n                        setStart: function(node, offset) {\n                            assertNotDetached(this);\n                            assertNoDocTypeNotationEntityAncestor(node, true);\n                            assertValidOffset(node, offset);\n                            setRangeStart(this, node, offset);\n                        },\n                        setEnd: function(node, offset) {\n                            assertNotDetached(this);\n                            assertNoDocTypeNotationEntityAncestor(node, true);\n                            assertValidOffset(node, offset);\n                            setRangeEnd(this, node, offset);\n                        },\n                        setStartAndEnd: function() {\n                            assertNotDetached(this);\n                            var args = arguments;\n                            var sc = args[0], so = args[1], ec = sc, eo = so;\n                            switch (args.length) {\n                              case 3:\n                                eo = args[2];\n                                break;\n\n                              case 4:\n                                ec = args[2];\n                                eo = args[3];\n                                break;\n                            }\n                            boundaryUpdater(this, sc, so, ec, eo);\n                        },\n                        setBoundary: function(node, offset, isStart) {\n                            this[\"set\" + (isStart ? \"Start\" : \"End\")](node, offset);\n                        },\n                        setStartBefore: createBeforeAfterNodeSetter(true, true),\n                        setStartAfter: createBeforeAfterNodeSetter(false, true),\n                        setEndBefore: createBeforeAfterNodeSetter(true, false),\n                        setEndAfter: createBeforeAfterNodeSetter(false, false),\n                        collapse: function(isStart) {\n                            assertRangeValid(this);\n                            if (isStart) {\n                                boundaryUpdater(this, this.startContainer, this.startOffset, this.startContainer, this.startOffset);\n                            } else {\n                                boundaryUpdater(this, this.endContainer, this.endOffset, this.endContainer, this.endOffset);\n                            }\n                        },\n                        selectNodeContents: function(node) {\n                            assertNotDetached(this);\n                            assertNoDocTypeNotationEntityAncestor(node, true);\n                            boundaryUpdater(this, node, 0, node, getNodeLength(node));\n                        },\n                        selectNode: function(node) {\n                            assertNotDetached(this);\n                            assertNoDocTypeNotationEntityAncestor(node, false);\n                            assertValidNodeType(node, beforeAfterNodeTypes);\n                            var start = getBoundaryBeforeNode(node), end = getBoundaryAfterNode(node);\n                            boundaryUpdater(this, start.node, start.offset, end.node, end.offset);\n                        },\n                        extractContents: createRangeContentRemover(extractSubtree, boundaryUpdater),\n                        deleteContents: createRangeContentRemover(deleteSubtree, boundaryUpdater),\n                        canSurroundContents: function() {\n                            assertRangeValid(this);\n                            assertNodeNotReadOnly(this.startContainer);\n                            assertNodeNotReadOnly(this.endContainer);\n                            var iterator = new RangeIterator(this, true);\n                            var boundariesInvalid = iterator._first && isNonTextPartiallySelected(iterator._first, this) || iterator._last && isNonTextPartiallySelected(iterator._last, this);\n                            iterator.detach();\n                            return !boundariesInvalid;\n                        },\n                        detach: function() {\n                            detacher(this);\n                        },\n                        splitBoundaries: function() {\n                            splitRangeBoundaries(this);\n                        },\n                        splitBoundariesPreservingPositions: function(positionsToPreserve) {\n                            splitRangeBoundaries(this, positionsToPreserve);\n                        },\n                        normalizeBoundaries: function() {\n                            assertRangeValid(this);\n                            var sc = this.startContainer, so = this.startOffset, ec = this.endContainer, eo = this.endOffset;\n                            var mergeForward = function(node) {\n                                var sibling = node.nextSibling;\n                                if (sibling && sibling.nodeType == node.nodeType) {\n                                    ec = node;\n                                    eo = node.length;\n                                    node.appendData(sibling.data);\n                                    sibling.parentNode.removeChild(sibling);\n                                }\n                            };\n                            var mergeBackward = function(node) {\n                                var sibling = node.previousSibling;\n                                if (sibling && sibling.nodeType == node.nodeType) {\n                                    sc = node;\n                                    var nodeLength = node.length;\n                                    so = sibling.length;\n                                    node.insertData(0, sibling.data);\n                                    sibling.parentNode.removeChild(sibling);\n                                    if (sc == ec) {\n                                        eo += so;\n                                        ec = sc;\n                                    } else if (ec == node.parentNode) {\n                                        var nodeIndex = getNodeIndex(node);\n                                        if (eo == nodeIndex) {\n                                            ec = node;\n                                            eo = nodeLength;\n                                        } else if (eo > nodeIndex) {\n                                            eo--;\n                                        }\n                                    }\n                                }\n                            };\n                            var normalizeStart = true;\n                            if (isCharacterDataNode(ec)) {\n                                if (ec.length == eo) {\n                                    mergeForward(ec);\n                                }\n                            } else {\n                                if (eo > 0) {\n                                    var endNode = ec.childNodes[eo - 1];\n                                    if (endNode && isCharacterDataNode(endNode)) {\n                                        mergeForward(endNode);\n                                    }\n                                }\n                                normalizeStart = !this.collapsed;\n                            }\n                            if (normalizeStart) {\n                                if (isCharacterDataNode(sc)) {\n                                    if (so == 0) {\n                                        mergeBackward(sc);\n                                    }\n                                } else {\n                                    if (so < sc.childNodes.length) {\n                                        var startNode = sc.childNodes[so];\n                                        if (startNode && isCharacterDataNode(startNode)) {\n                                            mergeBackward(startNode);\n                                        }\n                                    }\n                                }\n                            } else {\n                                sc = ec;\n                                so = eo;\n                            }\n                            boundaryUpdater(this, sc, so, ec, eo);\n                        },\n                        collapseToPoint: function(node, offset) {\n                            assertNotDetached(this);\n                            assertNoDocTypeNotationEntityAncestor(node, true);\n                            assertValidOffset(node, offset);\n                            this.setStartAndEnd(node, offset);\n                        }\n                    });\n                    copyComparisonConstants(constructor);\n                }\n                function updateCollapsedAndCommonAncestor(range) {\n                    range.collapsed = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n                    range.commonAncestorContainer = range.collapsed ? range.startContainer : dom.getCommonAncestor(range.startContainer, range.endContainer);\n                }\n                function updateBoundaries(range, startContainer, startOffset, endContainer, endOffset) {\n                    range.startContainer = startContainer;\n                    range.startOffset = startOffset;\n                    range.endContainer = endContainer;\n                    range.endOffset = endOffset;\n                    range.document = dom.getDocument(startContainer);\n                    updateCollapsedAndCommonAncestor(range);\n                }\n                function detach(range) {\n                    assertNotDetached(range);\n                    range.startContainer = range.startOffset = range.endContainer = range.endOffset = range.document = null;\n                    range.collapsed = range.commonAncestorContainer = null;\n                }\n                function Range(doc) {\n                    this.startContainer = doc;\n                    this.startOffset = 0;\n                    this.endContainer = doc;\n                    this.endOffset = 0;\n                    this.document = doc;\n                    updateCollapsedAndCommonAncestor(this);\n                }\n                createPrototypeRange(Range, updateBoundaries, detach);\n                util.extend(Range, {\n                    rangeProperties: rangeProperties,\n                    RangeIterator: RangeIterator,\n                    copyComparisonConstants: copyComparisonConstants,\n                    createPrototypeRange: createPrototypeRange,\n                    inspect: inspect,\n                    getRangeDocument: getRangeDocument,\n                    rangesEqual: function(r1, r2) {\n                        return r1.startContainer === r2.startContainer && r1.startOffset === r2.startOffset && r1.endContainer === r2.endContainer && r1.endOffset === r2.endOffset;\n                    }\n                });\n                api.DomRange = Range;\n                api.RangeException = RangeException;\n            });\n        }, {\n            \"./core\": 11\n        } ],\n        14: [ function(_dereq_, module, exports) {\n            var rangy = _dereq_(\"./core\");\n            rangy.api.createModule(\"SaveRestore\", [ \"WrappedRange\" ], function(api, module) {\n                var dom = api.dom;\n                var markerTextChar = \"\";\n                function gEBI(id, doc) {\n                    return (doc || document).getElementById(id);\n                }\n                function insertRangeBoundaryMarker(range, atStart) {\n                    var markerId = \"selectionBoundary_\" + +new Date() + \"_\" + (\"\" + Math.random()).slice(2);\n                    var markerEl;\n                    var doc = dom.getDocument(range.startContainer);\n                    var boundaryRange = range.cloneRange();\n                    boundaryRange.collapse(atStart);\n                    markerEl = doc.createElement(\"span\");\n                    markerEl.id = markerId;\n                    markerEl.style.lineHeight = \"0\";\n                    markerEl.style.display = \"none\";\n                    markerEl.className = \"rangySelectionBoundary\";\n                    markerEl.appendChild(doc.createTextNode(markerTextChar));\n                    boundaryRange.insertNode(markerEl);\n                    boundaryRange.detach();\n                    return markerEl;\n                }\n                function setRangeBoundary(doc, range, markerId, atStart) {\n                    var markerEl = gEBI(markerId, doc);\n                    if (markerEl) {\n                        range[atStart ? \"setStartBefore\" : \"setEndBefore\"](markerEl);\n                        markerEl.parentNode.removeChild(markerEl);\n                    } else {\n                        module.warn(\"Marker element has been removed. Cannot restore selection.\");\n                    }\n                }\n                function compareRanges(r1, r2) {\n                    return r2.compareBoundaryPoints(r1.START_TO_START, r1);\n                }\n                function saveRange(range, backward) {\n                    var startEl, endEl, doc = api.DomRange.getRangeDocument(range), text = range.toString();\n                    if (range.collapsed) {\n                        endEl = insertRangeBoundaryMarker(range, false);\n                        return {\n                            document: doc,\n                            markerId: endEl.id,\n                            collapsed: true\n                        };\n                    } else {\n                        endEl = insertRangeBoundaryMarker(range, false);\n                        startEl = insertRangeBoundaryMarker(range, true);\n                        return {\n                            document: doc,\n                            startMarkerId: startEl.id,\n                            endMarkerId: endEl.id,\n                            collapsed: false,\n                            backward: backward,\n                            toString: function() {\n                                return \"original text: '\" + text + \"', new text: '\" + range.toString() + \"'\";\n                            }\n                        };\n                    }\n                }\n                function restoreRange(rangeInfo, normalize) {\n                    var doc = rangeInfo.document;\n                    if (typeof normalize == \"undefined\") {\n                        normalize = true;\n                    }\n                    var range = api.createRange(doc);\n                    if (rangeInfo.collapsed) {\n                        var markerEl = gEBI(rangeInfo.markerId, doc);\n                        if (markerEl) {\n                            markerEl.style.display = \"inline\";\n                            var previousNode = markerEl.previousSibling;\n                            if (previousNode && previousNode.nodeType == 3) {\n                                markerEl.parentNode.removeChild(markerEl);\n                                range.collapseToPoint(previousNode, previousNode.length);\n                            } else {\n                                range.collapseBefore(markerEl);\n                                markerEl.parentNode.removeChild(markerEl);\n                            }\n                        } else {\n                            module.warn(\"Marker element has been removed. Cannot restore selection.\");\n                        }\n                    } else {\n                        setRangeBoundary(doc, range, rangeInfo.startMarkerId, true);\n                        setRangeBoundary(doc, range, rangeInfo.endMarkerId, false);\n                    }\n                    if (normalize) {\n                        range.normalizeBoundaries();\n                    }\n                    return range;\n                }\n                function saveRanges(ranges, backward) {\n                    var rangeInfos = [], range, doc;\n                    ranges = ranges.slice(0);\n                    ranges.sort(compareRanges);\n                    for (var i = 0, len = ranges.length; i < len; ++i) {\n                        rangeInfos[i] = saveRange(ranges[i], backward);\n                    }\n                    for (i = len - 1; i >= 0; --i) {\n                        range = ranges[i];\n                        doc = api.DomRange.getRangeDocument(range);\n                        if (range.collapsed) {\n                            range.collapseAfter(gEBI(rangeInfos[i].markerId, doc));\n                        } else {\n                            range.setEndBefore(gEBI(rangeInfos[i].endMarkerId, doc));\n                            range.setStartAfter(gEBI(rangeInfos[i].startMarkerId, doc));\n                        }\n                    }\n                    return rangeInfos;\n                }\n                function saveSelection(win) {\n                    if (!api.isSelectionValid(win)) {\n                        module.warn(\"Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.\");\n                        return null;\n                    }\n                    var sel = api.getSelection(win);\n                    var ranges = sel.getAllRanges();\n                    var backward = ranges.length == 1 && sel.isBackward();\n                    var rangeInfos = saveRanges(ranges, backward);\n                    if (backward) {\n                        sel.setSingleRange(ranges[0], \"backward\");\n                    } else {\n                        sel.setRanges(ranges);\n                    }\n                    return {\n                        win: win,\n                        rangeInfos: rangeInfos,\n                        restored: false\n                    };\n                }\n                function restoreRanges(rangeInfos) {\n                    var ranges = [];\n                    var rangeCount = rangeInfos.length;\n                    for (var i = rangeCount - 1; i >= 0; i--) {\n                        ranges[i] = restoreRange(rangeInfos[i], true);\n                    }\n                    return ranges;\n                }\n                function restoreSelection(savedSelection, preserveDirection) {\n                    if (!savedSelection.restored) {\n                        var rangeInfos = savedSelection.rangeInfos;\n                        var sel = api.getSelection(savedSelection.win);\n                        var ranges = restoreRanges(rangeInfos), rangeCount = rangeInfos.length;\n                        if (rangeCount == 1 && preserveDirection && api.features.selectionHasExtend && rangeInfos[0].backward) {\n                            sel.removeAllRanges();\n                            sel.addRange(ranges[0], true);\n                        } else {\n                            sel.setRanges(ranges);\n                        }\n                        savedSelection.restored = true;\n                    }\n                }\n                function removeMarkerElement(doc, markerId) {\n                    var markerEl = gEBI(markerId, doc);\n                    if (markerEl) {\n                        markerEl.parentNode.removeChild(markerEl);\n                    }\n                }\n                function removeMarkers(savedSelection) {\n                    var rangeInfos = savedSelection.rangeInfos;\n                    for (var i = 0, len = rangeInfos.length, rangeInfo; i < len; ++i) {\n                        rangeInfo = rangeInfos[i];\n                        if (rangeInfo.collapsed) {\n                            removeMarkerElement(savedSelection.doc, rangeInfo.markerId);\n                        } else {\n                            removeMarkerElement(savedSelection.doc, rangeInfo.startMarkerId);\n                            removeMarkerElement(savedSelection.doc, rangeInfo.endMarkerId);\n                        }\n                    }\n                }\n                api.util.extend(api, {\n                    saveRange: saveRange,\n                    restoreRange: restoreRange,\n                    saveRanges: saveRanges,\n                    restoreRanges: restoreRanges,\n                    saveSelection: saveSelection,\n                    restoreSelection: restoreSelection,\n                    removeMarkerElement: removeMarkerElement,\n                    removeMarkers: removeMarkers\n                });\n            });\n        }, {\n            \"./core\": 11\n        } ],\n        15: [ function(_dereq_, module, exports) {\n            var rangy = _dereq_(\"./core\");\n            rangy.api.createCoreModule(\"WrappedRange\", [ \"DomRange\" ], function(api, module) {\n                var WrappedRange, WrappedTextRange;\n                var dom = api.dom;\n                var util = api.util;\n                var DomPosition = dom.DomPosition;\n                var DomRange = api.DomRange;\n                var getBody = dom.getBody;\n                var getContentDocument = dom.getContentDocument;\n                var isCharacterDataNode = dom.isCharacterDataNode;\n                if (api.features.implementsDomRange) {\n                    (function() {\n                        var rangeProto;\n                        var rangeProperties = DomRange.rangeProperties;\n                        function updateRangeProperties(range) {\n                            var i = rangeProperties.length, prop;\n                            while (i--) {\n                                prop = rangeProperties[i];\n                                range[prop] = range.nativeRange[prop];\n                            }\n                            range.collapsed = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n                        }\n                        function updateNativeRange(range, startContainer, startOffset, endContainer, endOffset) {\n                            var startMoved = range.startContainer !== startContainer || range.startOffset != startOffset;\n                            var endMoved = range.endContainer !== endContainer || range.endOffset != endOffset;\n                            var nativeRangeDifferent = !range.equals(range.nativeRange);\n                            if (startMoved || endMoved || nativeRangeDifferent) {\n                                range.setEnd(endContainer, endOffset);\n                                range.setStart(startContainer, startOffset);\n                            }\n                        }\n                        function detach(range) {\n                            range.nativeRange.detach();\n                            range.detached = true;\n                            var i = rangeProperties.length;\n                            while (i--) {\n                                range[rangeProperties[i]] = null;\n                            }\n                        }\n                        var createBeforeAfterNodeSetter;\n                        WrappedRange = function(range) {\n                            if (!range) {\n                                throw module.createError(\"WrappedRange: Range must be specified\");\n                            }\n                            this.nativeRange = range;\n                            updateRangeProperties(this);\n                        };\n                        DomRange.createPrototypeRange(WrappedRange, updateNativeRange, detach);\n                        rangeProto = WrappedRange.prototype;\n                        rangeProto.selectNode = function(node) {\n                            this.nativeRange.selectNode(node);\n                            updateRangeProperties(this);\n                        };\n                        rangeProto.cloneContents = function() {\n                            return this.nativeRange.cloneContents();\n                        };\n                        rangeProto.surroundContents = function(node) {\n                            this.nativeRange.surroundContents(node);\n                            updateRangeProperties(this);\n                        };\n                        rangeProto.collapse = function(isStart) {\n                            this.nativeRange.collapse(isStart);\n                            updateRangeProperties(this);\n                        };\n                        rangeProto.cloneRange = function() {\n                            return new WrappedRange(this.nativeRange.cloneRange());\n                        };\n                        rangeProto.refresh = function() {\n                            updateRangeProperties(this);\n                        };\n                        rangeProto.toString = function() {\n                            return this.nativeRange.toString();\n                        };\n                        var testTextNode = document.createTextNode(\"test\");\n                        getBody(document).appendChild(testTextNode);\n                        var range = document.createRange();\n                        range.setStart(testTextNode, 0);\n                        range.setEnd(testTextNode, 0);\n                        try {\n                            range.setStart(testTextNode, 1);\n                            rangeProto.setStart = function(node, offset) {\n                                this.nativeRange.setStart(node, offset);\n                                updateRangeProperties(this);\n                            };\n                            rangeProto.setEnd = function(node, offset) {\n                                this.nativeRange.setEnd(node, offset);\n                                updateRangeProperties(this);\n                            };\n                            createBeforeAfterNodeSetter = function(name) {\n                                return function(node) {\n                                    this.nativeRange[name](node);\n                                    updateRangeProperties(this);\n                                };\n                            };\n                        } catch (ex) {\n                            rangeProto.setStart = function(node, offset) {\n                                try {\n                                    this.nativeRange.setStart(node, offset);\n                                } catch (ex) {\n                                    this.nativeRange.setEnd(node, offset);\n                                    this.nativeRange.setStart(node, offset);\n                                }\n                                updateRangeProperties(this);\n                            };\n                            rangeProto.setEnd = function(node, offset) {\n                                try {\n                                    this.nativeRange.setEnd(node, offset);\n                                } catch (ex) {\n                                    this.nativeRange.setStart(node, offset);\n                                    this.nativeRange.setEnd(node, offset);\n                                }\n                                updateRangeProperties(this);\n                            };\n                            createBeforeAfterNodeSetter = function(name, oppositeName) {\n                                return function(node) {\n                                    try {\n                                        this.nativeRange[name](node);\n                                    } catch (ex) {\n                                        this.nativeRange[oppositeName](node);\n                                        this.nativeRange[name](node);\n                                    }\n                                    updateRangeProperties(this);\n                                };\n                            };\n                        }\n                        rangeProto.setStartBefore = createBeforeAfterNodeSetter(\"setStartBefore\", \"setEndBefore\");\n                        rangeProto.setStartAfter = createBeforeAfterNodeSetter(\"setStartAfter\", \"setEndAfter\");\n                        rangeProto.setEndBefore = createBeforeAfterNodeSetter(\"setEndBefore\", \"setStartBefore\");\n                        rangeProto.setEndAfter = createBeforeAfterNodeSetter(\"setEndAfter\", \"setStartAfter\");\n                        rangeProto.selectNodeContents = function(node) {\n                            this.setStartAndEnd(node, 0, dom.getNodeLength(node));\n                        };\n                        range.selectNodeContents(testTextNode);\n                        range.setEnd(testTextNode, 3);\n                        var range2 = document.createRange();\n                        range2.selectNodeContents(testTextNode);\n                        range2.setEnd(testTextNode, 4);\n                        range2.setStart(testTextNode, 2);\n                        if (range.compareBoundaryPoints(range.START_TO_END, range2) == -1 && range.compareBoundaryPoints(range.END_TO_START, range2) == 1) {\n                            rangeProto.compareBoundaryPoints = function(type, range) {\n                                range = range.nativeRange || range;\n                                if (type == range.START_TO_END) {\n                                    type = range.END_TO_START;\n                                } else if (type == range.END_TO_START) {\n                                    type = range.START_TO_END;\n                                }\n                                return this.nativeRange.compareBoundaryPoints(type, range);\n                            };\n                        } else {\n                            rangeProto.compareBoundaryPoints = function(type, range) {\n                                return this.nativeRange.compareBoundaryPoints(type, range.nativeRange || range);\n                            };\n                        }\n                        var el = document.createElement(\"div\");\n                        el.innerHTML = \"123\";\n                        var textNode = el.firstChild;\n                        var body = getBody(document);\n                        body.appendChild(el);\n                        range.setStart(textNode, 1);\n                        range.setEnd(textNode, 2);\n                        range.deleteContents();\n                        if (textNode.data == \"13\") {\n                            rangeProto.deleteContents = function() {\n                                this.nativeRange.deleteContents();\n                                updateRangeProperties(this);\n                            };\n                            rangeProto.extractContents = function() {\n                                var frag = this.nativeRange.extractContents();\n                                updateRangeProperties(this);\n                                return frag;\n                            };\n                        } else {}\n                        body.removeChild(el);\n                        body = null;\n                        if (util.isHostMethod(range, \"createContextualFragment\")) {\n                            rangeProto.createContextualFragment = function(fragmentStr) {\n                                return this.nativeRange.createContextualFragment(fragmentStr);\n                            };\n                        }\n                        getBody(document).removeChild(testTextNode);\n                        range.detach();\n                        range2.detach();\n                        rangeProto.getName = function() {\n                            return \"WrappedRange\";\n                        };\n                        api.WrappedRange = WrappedRange;\n                        api.createNativeRange = function(doc) {\n                            doc = getContentDocument(doc, module, \"createNativeRange\");\n                            return doc.createRange();\n                        };\n                    })();\n                }\n                if (api.features.implementsTextRange) {\n                    var getTextRangeContainerElement = function(textRange) {\n                        var parentEl = textRange.parentElement();\n                        var range = textRange.duplicate();\n                        range.collapse(true);\n                        var startEl = range.parentElement();\n                        range = textRange.duplicate();\n                        range.collapse(false);\n                        var endEl = range.parentElement();\n                        var startEndContainer = startEl == endEl ? startEl : dom.getCommonAncestor(startEl, endEl);\n                        return startEndContainer == parentEl ? startEndContainer : dom.getCommonAncestor(parentEl, startEndContainer);\n                    };\n                    var textRangeIsCollapsed = function(textRange) {\n                        return textRange.compareEndPoints(\"StartToEnd\", textRange) == 0;\n                    };\n                    var getTextRangeBoundaryPosition = function(textRange, wholeRangeContainerElement, isStart, isCollapsed, startInfo) {\n                        var workingRange = textRange.duplicate();\n                        workingRange.collapse(isStart);\n                        var containerElement = workingRange.parentElement();\n                        if (!dom.isOrIsAncestorOf(wholeRangeContainerElement, containerElement)) {\n                            containerElement = wholeRangeContainerElement;\n                        }\n                        if (!containerElement.canHaveHTML) {\n                            var pos = new DomPosition(containerElement.parentNode, dom.getNodeIndex(containerElement));\n                            return {\n                                boundaryPosition: pos,\n                                nodeInfo: {\n                                    nodeIndex: pos.offset,\n                                    containerElement: pos.node\n                                }\n                            };\n                        }\n                        var workingNode = dom.getDocument(containerElement).createElement(\"span\");\n                        if (workingNode.parentNode) {\n                            workingNode.parentNode.removeChild(workingNode);\n                        }\n                        var comparison, workingComparisonType = isStart ? \"StartToStart\" : \"StartToEnd\";\n                        var previousNode, nextNode, boundaryPosition, boundaryNode;\n                        var start = startInfo && startInfo.containerElement == containerElement ? startInfo.nodeIndex : 0;\n                        var childNodeCount = containerElement.childNodes.length;\n                        var end = childNodeCount;\n                        var nodeIndex = end;\n                        while (true) {\n                            if (nodeIndex == childNodeCount) {\n                                containerElement.appendChild(workingNode);\n                            } else {\n                                containerElement.insertBefore(workingNode, containerElement.childNodes[nodeIndex]);\n                            }\n                            workingRange.moveToElementText(workingNode);\n                            comparison = workingRange.compareEndPoints(workingComparisonType, textRange);\n                            if (comparison == 0 || start == end) {\n                                break;\n                            } else if (comparison == -1) {\n                                if (end == start + 1) {\n                                    break;\n                                } else {\n                                    start = nodeIndex;\n                                }\n                            } else {\n                                end = end == start + 1 ? start : nodeIndex;\n                            }\n                            nodeIndex = Math.floor((start + end) / 2);\n                            containerElement.removeChild(workingNode);\n                        }\n                        boundaryNode = workingNode.nextSibling;\n                        if (comparison == -1 && boundaryNode && isCharacterDataNode(boundaryNode)) {\n                            workingRange.setEndPoint(isStart ? \"EndToStart\" : \"EndToEnd\", textRange);\n                            var offset;\n                            if (/[\\r\\n]/.test(boundaryNode.data)) {\n                                var tempRange = workingRange.duplicate();\n                                var rangeLength = tempRange.text.replace(/\\r\\n/g, \"\\r\").length;\n                                offset = tempRange.moveStart(\"character\", rangeLength);\n                                while ((comparison = tempRange.compareEndPoints(\"StartToEnd\", tempRange)) == -1) {\n                                    offset++;\n                                    tempRange.moveStart(\"character\", 1);\n                                }\n                            } else {\n                                offset = workingRange.text.length;\n                            }\n                            boundaryPosition = new DomPosition(boundaryNode, offset);\n                        } else {\n                            previousNode = (isCollapsed || !isStart) && workingNode.previousSibling;\n                            nextNode = (isCollapsed || isStart) && workingNode.nextSibling;\n                            if (nextNode && isCharacterDataNode(nextNode)) {\n                                boundaryPosition = new DomPosition(nextNode, 0);\n                            } else if (previousNode && isCharacterDataNode(previousNode)) {\n                                boundaryPosition = new DomPosition(previousNode, previousNode.data.length);\n                            } else {\n                                boundaryPosition = new DomPosition(containerElement, dom.getNodeIndex(workingNode));\n                            }\n                        }\n                        workingNode.parentNode.removeChild(workingNode);\n                        return {\n                            boundaryPosition: boundaryPosition,\n                            nodeInfo: {\n                                nodeIndex: nodeIndex,\n                                containerElement: containerElement\n                            }\n                        };\n                    };\n                    var createBoundaryTextRange = function(boundaryPosition, isStart) {\n                        var boundaryNode, boundaryParent, boundaryOffset = boundaryPosition.offset;\n                        var doc = dom.getDocument(boundaryPosition.node);\n                        var workingNode, childNodes, workingRange = getBody(doc).createTextRange();\n                        var nodeIsDataNode = isCharacterDataNode(boundaryPosition.node);\n                        if (nodeIsDataNode) {\n                            boundaryNode = boundaryPosition.node;\n                            boundaryParent = boundaryNode.parentNode;\n                        } else {\n                            childNodes = boundaryPosition.node.childNodes;\n                            boundaryNode = boundaryOffset < childNodes.length ? childNodes[boundaryOffset] : null;\n                            boundaryParent = boundaryPosition.node;\n                        }\n                        workingNode = doc.createElement(\"span\");\n                        workingNode.innerHTML = \"&#feff;\";\n                        if (boundaryNode) {\n                            boundaryParent.insertBefore(workingNode, boundaryNode);\n                        } else {\n                            boundaryParent.appendChild(workingNode);\n                        }\n                        workingRange.moveToElementText(workingNode);\n                        workingRange.collapse(!isStart);\n                        boundaryParent.removeChild(workingNode);\n                        if (nodeIsDataNode) {\n                            workingRange[isStart ? \"moveStart\" : \"moveEnd\"](\"character\", boundaryOffset);\n                        }\n                        return workingRange;\n                    };\n                    WrappedTextRange = function(textRange) {\n                        this.textRange = textRange;\n                        this.refresh();\n                    };\n                    WrappedTextRange.prototype = new DomRange(document);\n                    WrappedTextRange.prototype.refresh = function() {\n                        var start, end, startBoundary;\n                        var rangeContainerElement = getTextRangeContainerElement(this.textRange);\n                        if (textRangeIsCollapsed(this.textRange)) {\n                            end = start = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, true, true).boundaryPosition;\n                        } else {\n                            startBoundary = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, true, false);\n                            start = startBoundary.boundaryPosition;\n                            end = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, false, false, startBoundary.nodeInfo).boundaryPosition;\n                        }\n                        this.setStart(start.node, start.offset);\n                        this.setEnd(end.node, end.offset);\n                    };\n                    WrappedTextRange.prototype.getName = function() {\n                        return \"WrappedTextRange\";\n                    };\n                    DomRange.copyComparisonConstants(WrappedTextRange);\n                    WrappedTextRange.rangeToTextRange = function(range) {\n                        if (range.collapsed) {\n                            return createBoundaryTextRange(new DomPosition(range.startContainer, range.startOffset), true);\n                        } else {\n                            var startRange = createBoundaryTextRange(new DomPosition(range.startContainer, range.startOffset), true);\n                            var endRange = createBoundaryTextRange(new DomPosition(range.endContainer, range.endOffset), false);\n                            var textRange = getBody(DomRange.getRangeDocument(range)).createTextRange();\n                            textRange.setEndPoint(\"StartToStart\", startRange);\n                            textRange.setEndPoint(\"EndToEnd\", endRange);\n                            return textRange;\n                        }\n                    };\n                    api.WrappedTextRange = WrappedTextRange;\n                    if (!api.features.implementsDomRange || api.config.preferTextRange) {\n                        var globalObj = function() {\n                            return this;\n                        }();\n                        if (typeof globalObj.Range == \"undefined\") {\n                            globalObj.Range = WrappedTextRange;\n                        }\n                        api.createNativeRange = function(doc) {\n                            doc = getContentDocument(doc, module, \"createNativeRange\");\n                            return getBody(doc).createTextRange();\n                        };\n                        api.WrappedRange = WrappedTextRange;\n                    }\n                }\n                api.createRange = function(doc) {\n                    doc = getContentDocument(doc, module, \"createRange\");\n                    return new api.WrappedRange(api.createNativeRange(doc));\n                };\n                api.createRangyRange = function(doc) {\n                    doc = getContentDocument(doc, module, \"createRangyRange\");\n                    return new DomRange(doc);\n                };\n                api.createIframeRange = function(iframeEl) {\n                    module.deprecationNotice(\"createIframeRange()\", \"createRange(iframeEl)\");\n                    return api.createRange(iframeEl);\n                };\n                api.createIframeRangyRange = function(iframeEl) {\n                    module.deprecationNotice(\"createIframeRangyRange()\", \"createRangyRange(iframeEl)\");\n                    return api.createRangyRange(iframeEl);\n                };\n                api.addCreateMissingNativeApiListener(function(win) {\n                    var doc = win.document;\n                    if (typeof doc.createRange == \"undefined\") {\n                        doc.createRange = function() {\n                            return api.createRange(doc);\n                        };\n                    }\n                    doc = win = null;\n                });\n            });\n        }, {\n            \"./core\": 11\n        } ],\n        16: [ function(_dereq_, module, exports) {\n            var rangy = _dereq_(\"./core\");\n            rangy.api.createCoreModule(\"WrappedSelection\", [ \"DomRange\", \"WrappedRange\" ], function(api, module) {\n                api.config.checkSelectionRanges = true;\n                var BOOLEAN = \"boolean\";\n                var NUMBER = \"number\";\n                var dom = api.dom;\n                var util = api.util;\n                var isHostMethod = util.isHostMethod;\n                var DomRange = api.DomRange;\n                var WrappedRange = api.WrappedRange;\n                var DOMException = api.DOMException;\n                var DomPosition = dom.DomPosition;\n                var getNativeSelection;\n                var selectionIsCollapsed;\n                var features = api.features;\n                var CONTROL = \"Control\";\n                var getDocument = dom.getDocument;\n                var getBody = dom.getBody;\n                var rangesEqual = DomRange.rangesEqual;\n                function isDirectionBackward(dir) {\n                    return typeof dir == \"string\" ? /^backward(s)?$/i.test(dir) : !!dir;\n                }\n                function getWindow(win, methodName) {\n                    if (!win) {\n                        return window;\n                    } else if (dom.isWindow(win)) {\n                        return win;\n                    } else if (win instanceof WrappedSelection) {\n                        return win.win;\n                    } else {\n                        var doc = dom.getContentDocument(win, module, methodName);\n                        return dom.getWindow(doc);\n                    }\n                }\n                function getWinSelection(winParam) {\n                    return getWindow(winParam, \"getWinSelection\").getSelection();\n                }\n                function getDocSelection(winParam) {\n                    return getWindow(winParam, \"getDocSelection\").document.selection;\n                }\n                function winSelectionIsBackward(sel) {\n                    var backward = false;\n                    if (sel.anchorNode) {\n                        backward = dom.comparePoints(sel.anchorNode, sel.anchorOffset, sel.focusNode, sel.focusOffset) == 1;\n                    }\n                    return backward;\n                }\n                var implementsWinGetSelection = isHostMethod(window, \"getSelection\"), implementsDocSelection = util.isHostObject(document, \"selection\");\n                features.implementsWinGetSelection = implementsWinGetSelection;\n                features.implementsDocSelection = implementsDocSelection;\n                var useDocumentSelection = implementsDocSelection && (!implementsWinGetSelection || api.config.preferTextRange);\n                if (useDocumentSelection) {\n                    getNativeSelection = getDocSelection;\n                    api.isSelectionValid = function(winParam) {\n                        var doc = getWindow(winParam, \"isSelectionValid\").document, nativeSel = doc.selection;\n                        return nativeSel.type != \"None\" || getDocument(nativeSel.createRange().parentElement()) == doc;\n                    };\n                } else if (implementsWinGetSelection) {\n                    getNativeSelection = getWinSelection;\n                    api.isSelectionValid = function() {\n                        return true;\n                    };\n                } else {\n                    module.fail(\"Neither document.selection or window.getSelection() detected.\");\n                }\n                api.getNativeSelection = getNativeSelection;\n                var testSelection = getNativeSelection();\n                var testRange = api.createNativeRange(document);\n                var body = getBody(document);\n                var selectionHasAnchorAndFocus = util.areHostProperties(testSelection, [ \"anchorNode\", \"focusNode\", \"anchorOffset\", \"focusOffset\" ]);\n                features.selectionHasAnchorAndFocus = selectionHasAnchorAndFocus;\n                var selectionHasExtend = isHostMethod(testSelection, \"extend\");\n                features.selectionHasExtend = selectionHasExtend;\n                var selectionHasRangeCount = typeof testSelection.rangeCount == NUMBER;\n                features.selectionHasRangeCount = selectionHasRangeCount;\n                var selectionSupportsMultipleRanges = false;\n                var collapsedNonEditableSelectionsSupported = true;\n                var addRangeBackwardToNative = selectionHasExtend ? function(nativeSelection, range) {\n                    var doc = DomRange.getRangeDocument(range);\n                    var endRange = api.createRange(doc);\n                    endRange.collapseToPoint(range.endContainer, range.endOffset);\n                    nativeSelection.addRange(getNativeRange(endRange));\n                    nativeSelection.extend(range.startContainer, range.startOffset);\n                } : null;\n                if (util.areHostMethods(testSelection, [ \"addRange\", \"getRangeAt\", \"removeAllRanges\" ]) && typeof testSelection.rangeCount == NUMBER && features.implementsDomRange) {\n                    (function() {\n                        var sel = window.getSelection();\n                        if (sel) {\n                            var originalSelectionRangeCount = sel.rangeCount;\n                            var selectionHasMultipleRanges = originalSelectionRangeCount > 1;\n                            var originalSelectionRanges = [];\n                            var originalSelectionBackward = winSelectionIsBackward(sel);\n                            for (var i = 0; i < originalSelectionRangeCount; ++i) {\n                                originalSelectionRanges[i] = sel.getRangeAt(i);\n                            }\n                            var body = getBody(document);\n                            var testEl = body.appendChild(document.createElement(\"div\"));\n                            testEl.contentEditable = \"false\";\n                            var textNode = testEl.appendChild(document.createTextNode(\"\"));\n                            var r1 = document.createRange();\n                            r1.setStart(textNode, 1);\n                            r1.collapse(true);\n                            sel.addRange(r1);\n                            collapsedNonEditableSelectionsSupported = sel.rangeCount == 1;\n                            sel.removeAllRanges();\n                            if (!selectionHasMultipleRanges) {\n                                var r2 = r1.cloneRange();\n                                r1.setStart(textNode, 0);\n                                r2.setEnd(textNode, 3);\n                                r2.setStart(textNode, 2);\n                                sel.addRange(r1);\n                                sel.addRange(r2);\n                                selectionSupportsMultipleRanges = sel.rangeCount == 2;\n                                r2.detach();\n                            }\n                            body.removeChild(testEl);\n                            sel.removeAllRanges();\n                            r1.detach();\n                            for (i = 0; i < originalSelectionRangeCount; ++i) {\n                                if (i == 0 && originalSelectionBackward) {\n                                    if (addRangeBackwardToNative) {\n                                        addRangeBackwardToNative(sel, originalSelectionRanges[i]);\n                                    } else {\n                                        api.warn(\"Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend\");\n                                        sel.addRange(originalSelectionRanges[i]);\n                                    }\n                                } else {\n                                    sel.addRange(originalSelectionRanges[i]);\n                                }\n                            }\n                        }\n                    })();\n                }\n                features.selectionSupportsMultipleRanges = selectionSupportsMultipleRanges;\n                features.collapsedNonEditableSelectionsSupported = collapsedNonEditableSelectionsSupported;\n                var implementsControlRange = false, testControlRange;\n                if (body && isHostMethod(body, \"createControlRange\")) {\n                    testControlRange = body.createControlRange();\n                    if (util.areHostProperties(testControlRange, [ \"item\", \"add\" ])) {\n                        implementsControlRange = true;\n                    }\n                }\n                features.implementsControlRange = implementsControlRange;\n                if (selectionHasAnchorAndFocus) {\n                    selectionIsCollapsed = function(sel) {\n                        return sel.anchorNode === sel.focusNode && sel.anchorOffset === sel.focusOffset;\n                    };\n                } else {\n                    selectionIsCollapsed = function(sel) {\n                        return sel.rangeCount ? sel.getRangeAt(sel.rangeCount - 1).collapsed : false;\n                    };\n                }\n                function updateAnchorAndFocusFromRange(sel, range, backward) {\n                    var anchorPrefix = backward ? \"end\" : \"start\", focusPrefix = backward ? \"start\" : \"end\";\n                    sel.anchorNode = range[anchorPrefix + \"Container\"];\n                    sel.anchorOffset = range[anchorPrefix + \"Offset\"];\n                    sel.focusNode = range[focusPrefix + \"Container\"];\n                    sel.focusOffset = range[focusPrefix + \"Offset\"];\n                }\n                function updateAnchorAndFocusFromNativeSelection(sel) {\n                    var nativeSel = sel.nativeSelection;\n                    sel.anchorNode = nativeSel.anchorNode;\n                    sel.anchorOffset = nativeSel.anchorOffset;\n                    sel.focusNode = nativeSel.focusNode;\n                    sel.focusOffset = nativeSel.focusOffset;\n                }\n                function updateEmptySelection(sel) {\n                    sel.anchorNode = sel.focusNode = null;\n                    sel.anchorOffset = sel.focusOffset = 0;\n                    sel.rangeCount = 0;\n                    sel.isCollapsed = true;\n                    sel._ranges.length = 0;\n                }\n                function getNativeRange(range) {\n                    var nativeRange;\n                    if (range instanceof DomRange) {\n                        nativeRange = api.createNativeRange(range.getDocument());\n                        nativeRange.setEnd(range.endContainer, range.endOffset);\n                        nativeRange.setStart(range.startContainer, range.startOffset);\n                    } else if (range instanceof WrappedRange) {\n                        nativeRange = range.nativeRange;\n                    } else if (features.implementsDomRange && range instanceof dom.getWindow(range.startContainer).Range) {\n                        nativeRange = range;\n                    }\n                    return nativeRange;\n                }\n                function rangeContainsSingleElement(rangeNodes) {\n                    if (!rangeNodes.length || rangeNodes[0].nodeType != 1) {\n                        return false;\n                    }\n                    for (var i = 1, len = rangeNodes.length; i < len; ++i) {\n                        if (!dom.isAncestorOf(rangeNodes[0], rangeNodes[i])) {\n                            return false;\n                        }\n                    }\n                    return true;\n                }\n                function getSingleElementFromRange(range) {\n                    var nodes = range.getNodes();\n                    if (!rangeContainsSingleElement(nodes)) {\n                        throw module.createError(\"getSingleElementFromRange: range \" + range.inspect() + \" did not consist of a single element\");\n                    }\n                    return nodes[0];\n                }\n                function isTextRange(range) {\n                    return !!range && typeof range.text != \"undefined\";\n                }\n                function updateFromTextRange(sel, range) {\n                    var wrappedRange = new WrappedRange(range);\n                    sel._ranges = [ wrappedRange ];\n                    updateAnchorAndFocusFromRange(sel, wrappedRange, false);\n                    sel.rangeCount = 1;\n                    sel.isCollapsed = wrappedRange.collapsed;\n                }\n                function updateControlSelection(sel) {\n                    sel._ranges.length = 0;\n                    if (sel.docSelection.type == \"None\") {\n                        updateEmptySelection(sel);\n                    } else {\n                        var controlRange = sel.docSelection.createRange();\n                        if (isTextRange(controlRange)) {\n                            updateFromTextRange(sel, controlRange);\n                        } else {\n                            sel.rangeCount = controlRange.length;\n                            var range, doc = getDocument(controlRange.item(0));\n                            for (var i = 0; i < sel.rangeCount; ++i) {\n                                range = api.createRange(doc);\n                                range.selectNode(controlRange.item(i));\n                                sel._ranges.push(range);\n                            }\n                            sel.isCollapsed = sel.rangeCount == 1 && sel._ranges[0].collapsed;\n                            updateAnchorAndFocusFromRange(sel, sel._ranges[sel.rangeCount - 1], false);\n                        }\n                    }\n                }\n                function addRangeToControlSelection(sel, range) {\n                    var controlRange = sel.docSelection.createRange();\n                    var rangeElement = getSingleElementFromRange(range);\n                    var doc = getDocument(controlRange.item(0));\n                    var newControlRange = getBody(doc).createControlRange();\n                    for (var i = 0, len = controlRange.length; i < len; ++i) {\n                        newControlRange.add(controlRange.item(i));\n                    }\n                    try {\n                        newControlRange.add(rangeElement);\n                    } catch (ex) {\n                        throw module.createError(\"addRange(): Element within the specified Range could not be added to control selection (does it have layout?)\");\n                    }\n                    newControlRange.select();\n                    updateControlSelection(sel);\n                }\n                var getSelectionRangeAt;\n                if (isHostMethod(testSelection, \"getRangeAt\")) {\n                    getSelectionRangeAt = function(sel, index) {\n                        try {\n                            return sel.getRangeAt(index);\n                        } catch (ex) {\n                            return null;\n                        }\n                    };\n                } else if (selectionHasAnchorAndFocus) {\n                    getSelectionRangeAt = function(sel) {\n                        var doc = getDocument(sel.anchorNode);\n                        var range = api.createRange(doc);\n                        range.setStartAndEnd(sel.anchorNode, sel.anchorOffset, sel.focusNode, sel.focusOffset);\n                        if (range.collapsed !== this.isCollapsed) {\n                            range.setStartAndEnd(sel.focusNode, sel.focusOffset, sel.anchorNode, sel.anchorOffset);\n                        }\n                        return range;\n                    };\n                }\n                function WrappedSelection(selection, docSelection, win) {\n                    this.nativeSelection = selection;\n                    this.docSelection = docSelection;\n                    this._ranges = [];\n                    this.win = win;\n                    this.refresh();\n                }\n                WrappedSelection.prototype = api.selectionPrototype;\n                function deleteProperties(sel) {\n                    sel.win = sel.anchorNode = sel.focusNode = sel._ranges = null;\n                    sel.rangeCount = sel.anchorOffset = sel.focusOffset = 0;\n                    sel.detached = true;\n                }\n                var cachedRangySelections = [];\n                function actOnCachedSelection(win, action) {\n                    var i = cachedRangySelections.length, cached, sel;\n                    while (i--) {\n                        cached = cachedRangySelections[i];\n                        sel = cached.selection;\n                        if (action == \"deleteAll\") {\n                            deleteProperties(sel);\n                        } else if (cached.win == win) {\n                            if (action == \"delete\") {\n                                cachedRangySelections.splice(i, 1);\n                                return true;\n                            } else {\n                                return sel;\n                            }\n                        }\n                    }\n                    if (action == \"deleteAll\") {\n                        cachedRangySelections.length = 0;\n                    }\n                    return null;\n                }\n                var getSelection = function(win) {\n                    if (win && win instanceof WrappedSelection) {\n                        win.refresh();\n                        return win;\n                    }\n                    win = getWindow(win, \"getNativeSelection\");\n                    var sel = actOnCachedSelection(win);\n                    var nativeSel = getNativeSelection(win), docSel = implementsDocSelection ? getDocSelection(win) : null;\n                    if (sel) {\n                        sel.nativeSelection = nativeSel;\n                        sel.docSelection = docSel;\n                        sel.refresh();\n                    } else {\n                        sel = new WrappedSelection(nativeSel, docSel, win);\n                        cachedRangySelections.push({\n                            win: win,\n                            selection: sel\n                        });\n                    }\n                    return sel;\n                };\n                api.getSelection = getSelection;\n                api.getIframeSelection = function(iframeEl) {\n                    module.deprecationNotice(\"getIframeSelection()\", \"getSelection(iframeEl)\");\n                    return api.getSelection(dom.getIframeWindow(iframeEl));\n                };\n                var selProto = WrappedSelection.prototype;\n                function createControlSelection(sel, ranges) {\n                    var doc = getDocument(ranges[0].startContainer);\n                    var controlRange = getBody(doc).createControlRange();\n                    for (var i = 0, el, len = ranges.length; i < len; ++i) {\n                        el = getSingleElementFromRange(ranges[i]);\n                        try {\n                            controlRange.add(el);\n                        } catch (ex) {\n                            throw module.createError(\"setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)\");\n                        }\n                    }\n                    controlRange.select();\n                    updateControlSelection(sel);\n                }\n                if (!useDocumentSelection && selectionHasAnchorAndFocus && util.areHostMethods(testSelection, [ \"removeAllRanges\", \"addRange\" ])) {\n                    selProto.removeAllRanges = function() {\n                        this.nativeSelection.removeAllRanges();\n                        updateEmptySelection(this);\n                    };\n                    var addRangeBackward = function(sel, range) {\n                        addRangeBackwardToNative(sel.nativeSelection, range);\n                        sel.refresh();\n                    };\n                    if (selectionHasRangeCount) {\n                        selProto.addRange = function(range, direction) {\n                            if (implementsControlRange && implementsDocSelection && this.docSelection.type == CONTROL) {\n                                addRangeToControlSelection(this, range);\n                            } else {\n                                if (isDirectionBackward(direction) && selectionHasExtend) {\n                                    addRangeBackward(this, range);\n                                } else {\n                                    var previousRangeCount;\n                                    if (selectionSupportsMultipleRanges) {\n                                        previousRangeCount = this.rangeCount;\n                                    } else {\n                                        this.removeAllRanges();\n                                        previousRangeCount = 0;\n                                    }\n                                    this.nativeSelection.addRange(getNativeRange(range).cloneRange());\n                                    this.rangeCount = this.nativeSelection.rangeCount;\n                                    if (this.rangeCount == previousRangeCount + 1) {\n                                        if (api.config.checkSelectionRanges) {\n                                            var nativeRange = getSelectionRangeAt(this.nativeSelection, this.rangeCount - 1);\n                                            if (nativeRange && !rangesEqual(nativeRange, range)) {\n                                                range = new WrappedRange(nativeRange);\n                                            }\n                                        }\n                                        this._ranges[this.rangeCount - 1] = range;\n                                        updateAnchorAndFocusFromRange(this, range, selectionIsBackward(this.nativeSelection));\n                                        this.isCollapsed = selectionIsCollapsed(this);\n                                    } else {\n                                        this.refresh();\n                                    }\n                                }\n                            }\n                        };\n                    } else {\n                        selProto.addRange = function(range, direction) {\n                            if (isDirectionBackward(direction) && selectionHasExtend) {\n                                addRangeBackward(this, range);\n                            } else {\n                                this.nativeSelection.addRange(getNativeRange(range));\n                                this.refresh();\n                            }\n                        };\n                    }\n                    selProto.setRanges = function(ranges) {\n                        if (implementsControlRange && ranges.length > 1) {\n                            createControlSelection(this, ranges);\n                        } else {\n                            this.removeAllRanges();\n                            for (var i = 0, len = ranges.length; i < len; ++i) {\n                                this.addRange(ranges[i]);\n                            }\n                        }\n                    };\n                } else if (isHostMethod(testSelection, \"empty\") && isHostMethod(testRange, \"select\") && implementsControlRange && useDocumentSelection) {\n                    selProto.removeAllRanges = function() {\n                        try {\n                            this.docSelection.empty();\n                            if (this.docSelection.type != \"None\") {\n                                var doc;\n                                if (this.anchorNode) {\n                                    doc = getDocument(this.anchorNode);\n                                } else if (this.docSelection.type == CONTROL) {\n                                    var controlRange = this.docSelection.createRange();\n                                    if (controlRange.length) {\n                                        doc = getDocument(controlRange.item(0));\n                                    }\n                                }\n                                if (doc) {\n                                    var textRange = getBody(doc).createTextRange();\n                                    textRange.select();\n                                    this.docSelection.empty();\n                                }\n                            }\n                        } catch (ex) {}\n                        updateEmptySelection(this);\n                    };\n                    selProto.addRange = function(range) {\n                        if (this.docSelection.type == CONTROL) {\n                            addRangeToControlSelection(this, range);\n                        } else {\n                            api.WrappedTextRange.rangeToTextRange(range).select();\n                            this._ranges[0] = range;\n                            this.rangeCount = 1;\n                            this.isCollapsed = this._ranges[0].collapsed;\n                            updateAnchorAndFocusFromRange(this, range, false);\n                        }\n                    };\n                    selProto.setRanges = function(ranges) {\n                        this.removeAllRanges();\n                        var rangeCount = ranges.length;\n                        if (rangeCount > 1) {\n                            createControlSelection(this, ranges);\n                        } else if (rangeCount) {\n                            this.addRange(ranges[0]);\n                        }\n                    };\n                } else {\n                    module.fail(\"No means of selecting a Range or TextRange was found\");\n                    return false;\n                }\n                selProto.getRangeAt = function(index) {\n                    if (index < 0 || index >= this.rangeCount) {\n                        throw new DOMException(\"INDEX_SIZE_ERR\");\n                    } else {\n                        return this._ranges[index].cloneRange();\n                    }\n                };\n                var refreshSelection;\n                if (useDocumentSelection) {\n                    refreshSelection = function(sel) {\n                        var range;\n                        if (api.isSelectionValid(sel.win)) {\n                            range = sel.docSelection.createRange();\n                        } else {\n                            range = getBody(sel.win.document).createTextRange();\n                            range.collapse(true);\n                        }\n                        if (sel.docSelection.type == CONTROL) {\n                            updateControlSelection(sel);\n                        } else if (isTextRange(range)) {\n                            updateFromTextRange(sel, range);\n                        } else {\n                            updateEmptySelection(sel);\n                        }\n                    };\n                } else if (isHostMethod(testSelection, \"getRangeAt\") && typeof testSelection.rangeCount == NUMBER) {\n                    refreshSelection = function(sel) {\n                        if (implementsControlRange && implementsDocSelection && sel.docSelection.type == CONTROL) {\n                            updateControlSelection(sel);\n                        } else {\n                            sel._ranges.length = sel.rangeCount = sel.nativeSelection.rangeCount;\n                            if (sel.rangeCount) {\n                                for (var i = 0, len = sel.rangeCount; i < len; ++i) {\n                                    sel._ranges[i] = new api.WrappedRange(sel.nativeSelection.getRangeAt(i));\n                                }\n                                updateAnchorAndFocusFromRange(sel, sel._ranges[sel.rangeCount - 1], selectionIsBackward(sel.nativeSelection));\n                                sel.isCollapsed = selectionIsCollapsed(sel);\n                            } else {\n                                updateEmptySelection(sel);\n                            }\n                        }\n                    };\n                } else if (selectionHasAnchorAndFocus && typeof testSelection.isCollapsed == BOOLEAN && typeof testRange.collapsed == BOOLEAN && features.implementsDomRange) {\n                    refreshSelection = function(sel) {\n                        var range, nativeSel = sel.nativeSelection;\n                        if (nativeSel.anchorNode) {\n                            range = getSelectionRangeAt(nativeSel, 0);\n                            sel._ranges = [ range ];\n                            sel.rangeCount = 1;\n                            updateAnchorAndFocusFromNativeSelection(sel);\n                            sel.isCollapsed = selectionIsCollapsed(sel);\n                        } else {\n                            updateEmptySelection(sel);\n                        }\n                    };\n                } else {\n                    module.fail(\"No means of obtaining a Range or TextRange from the user's selection was found\");\n                    return false;\n                }\n                selProto.refresh = function(checkForChanges) {\n                    var oldRanges = checkForChanges ? this._ranges.slice(0) : null;\n                    var oldAnchorNode = this.anchorNode, oldAnchorOffset = this.anchorOffset;\n                    refreshSelection(this);\n                    if (checkForChanges) {\n                        var i = oldRanges.length;\n                        if (i != this._ranges.length) {\n                            return true;\n                        }\n                        if (this.anchorNode != oldAnchorNode || this.anchorOffset != oldAnchorOffset) {\n                            return true;\n                        }\n                        while (i--) {\n                            if (!rangesEqual(oldRanges[i], this._ranges[i])) {\n                                return true;\n                            }\n                        }\n                        return false;\n                    }\n                };\n                var removeRangeManually = function(sel, range) {\n                    var ranges = sel.getAllRanges();\n                    sel.removeAllRanges();\n                    for (var i = 0, len = ranges.length; i < len; ++i) {\n                        if (!rangesEqual(range, ranges[i])) {\n                            sel.addRange(ranges[i]);\n                        }\n                    }\n                    if (!sel.rangeCount) {\n                        updateEmptySelection(sel);\n                    }\n                };\n                if (implementsControlRange) {\n                    selProto.removeRange = function(range) {\n                        if (this.docSelection.type == CONTROL) {\n                            var controlRange = this.docSelection.createRange();\n                            var rangeElement = getSingleElementFromRange(range);\n                            var doc = getDocument(controlRange.item(0));\n                            var newControlRange = getBody(doc).createControlRange();\n                            var el, removed = false;\n                            for (var i = 0, len = controlRange.length; i < len; ++i) {\n                                el = controlRange.item(i);\n                                if (el !== rangeElement || removed) {\n                                    newControlRange.add(controlRange.item(i));\n                                } else {\n                                    removed = true;\n                                }\n                            }\n                            newControlRange.select();\n                            updateControlSelection(this);\n                        } else {\n                            removeRangeManually(this, range);\n                        }\n                    };\n                } else {\n                    selProto.removeRange = function(range) {\n                        removeRangeManually(this, range);\n                    };\n                }\n                var selectionIsBackward;\n                if (!useDocumentSelection && selectionHasAnchorAndFocus && features.implementsDomRange) {\n                    selectionIsBackward = winSelectionIsBackward;\n                    selProto.isBackward = function() {\n                        return selectionIsBackward(this);\n                    };\n                } else {\n                    selectionIsBackward = selProto.isBackward = function() {\n                        return false;\n                    };\n                }\n                selProto.isBackwards = selProto.isBackward;\n                selProto.toString = function() {\n                    var rangeTexts = [];\n                    for (var i = 0, len = this.rangeCount; i < len; ++i) {\n                        rangeTexts[i] = \"\" + this._ranges[i];\n                    }\n                    return rangeTexts.join(\"\");\n                };\n                function assertNodeInSameDocument(sel, node) {\n                    if (sel.win.document != getDocument(node)) {\n                        throw new DOMException(\"WRONG_DOCUMENT_ERR\");\n                    }\n                }\n                selProto.collapse = function(node, offset) {\n                    assertNodeInSameDocument(this, node);\n                    var range = api.createRange(node);\n                    range.collapseToPoint(node, offset);\n                    this.setSingleRange(range);\n                    this.isCollapsed = true;\n                };\n                selProto.collapseToStart = function() {\n                    if (this.rangeCount) {\n                        var range = this._ranges[0];\n                        this.collapse(range.startContainer, range.startOffset);\n                    } else {\n                        throw new DOMException(\"INVALID_STATE_ERR\");\n                    }\n                };\n                selProto.collapseToEnd = function() {\n                    if (this.rangeCount) {\n                        var range = this._ranges[this.rangeCount - 1];\n                        this.collapse(range.endContainer, range.endOffset);\n                    } else {\n                        throw new DOMException(\"INVALID_STATE_ERR\");\n                    }\n                };\n                selProto.selectAllChildren = function(node) {\n                    assertNodeInSameDocument(this, node);\n                    var range = api.createRange(node);\n                    range.selectNodeContents(node);\n                    this.setSingleRange(range);\n                };\n                selProto.deleteFromDocument = function() {\n                    if (implementsControlRange && implementsDocSelection && this.docSelection.type == CONTROL) {\n                        var controlRange = this.docSelection.createRange();\n                        var element;\n                        while (controlRange.length) {\n                            element = controlRange.item(0);\n                            controlRange.remove(element);\n                            element.parentNode.removeChild(element);\n                        }\n                        this.refresh();\n                    } else if (this.rangeCount) {\n                        var ranges = this.getAllRanges();\n                        if (ranges.length) {\n                            this.removeAllRanges();\n                            for (var i = 0, len = ranges.length; i < len; ++i) {\n                                ranges[i].deleteContents();\n                            }\n                            this.addRange(ranges[len - 1]);\n                        }\n                    }\n                };\n                selProto.eachRange = function(func, returnValue) {\n                    for (var i = 0, len = this._ranges.length; i < len; ++i) {\n                        if (func(this.getRangeAt(i))) {\n                            return returnValue;\n                        }\n                    }\n                };\n                selProto.getAllRanges = function() {\n                    var ranges = [];\n                    this.eachRange(function(range) {\n                        ranges.push(range);\n                    });\n                    return ranges;\n                };\n                selProto.setSingleRange = function(range, direction) {\n                    this.removeAllRanges();\n                    this.addRange(range, direction);\n                };\n                selProto.callMethodOnEachRange = function(methodName, params) {\n                    var results = [];\n                    this.eachRange(function(range) {\n                        results.push(range[methodName].apply(range, params));\n                    });\n                    return results;\n                };\n                function createStartOrEndSetter(isStart) {\n                    return function(node, offset) {\n                        var range;\n                        if (this.rangeCount) {\n                            range = this.getRangeAt(0);\n                            range[\"set\" + (isStart ? \"Start\" : \"End\")](node, offset);\n                        } else {\n                            range = api.createRange(this.win.document);\n                            range.setStartAndEnd(node, offset);\n                        }\n                        this.setSingleRange(range, this.isBackward());\n                    };\n                }\n                selProto.setStart = createStartOrEndSetter(true);\n                selProto.setEnd = createStartOrEndSetter(false);\n                api.rangePrototype.select = function(direction) {\n                    getSelection(this.getDocument()).setSingleRange(this, direction);\n                };\n                selProto.changeEachRange = function(func) {\n                    var ranges = [];\n                    var backward = this.isBackward();\n                    this.eachRange(function(range) {\n                        func(range);\n                        ranges.push(range);\n                    });\n                    this.removeAllRanges();\n                    if (backward && ranges.length == 1) {\n                        this.addRange(ranges[0], \"backward\");\n                    } else {\n                        this.setRanges(ranges);\n                    }\n                };\n                selProto.containsNode = function(node, allowPartial) {\n                    return this.eachRange(function(range) {\n                        return range.containsNode(node, allowPartial);\n                    }, true);\n                };\n                selProto.getBookmark = function(containerNode) {\n                    return {\n                        backward: this.isBackward(),\n                        rangeBookmarks: this.callMethodOnEachRange(\"getBookmark\", [ containerNode ])\n                    };\n                };\n                selProto.moveToBookmark = function(bookmark) {\n                    var selRanges = [];\n                    for (var i = 0, rangeBookmark, range; rangeBookmark = bookmark.rangeBookmarks[i++]; ) {\n                        range = api.createRange(this.win);\n                        range.moveToBookmark(rangeBookmark);\n                        selRanges.push(range);\n                    }\n                    if (bookmark.backward) {\n                        this.setSingleRange(selRanges[0], \"backward\");\n                    } else {\n                        this.setRanges(selRanges);\n                    }\n                };\n                selProto.toHtml = function() {\n                    return this.callMethodOnEachRange(\"toHtml\").join(\"\");\n                };\n                function inspect(sel) {\n                    var rangeInspects = [];\n                    var anchor = new DomPosition(sel.anchorNode, sel.anchorOffset);\n                    var focus = new DomPosition(sel.focusNode, sel.focusOffset);\n                    var name = typeof sel.getName == \"function\" ? sel.getName() : \"Selection\";\n                    if (typeof sel.rangeCount != \"undefined\") {\n                        for (var i = 0, len = sel.rangeCount; i < len; ++i) {\n                            rangeInspects[i] = DomRange.inspect(sel.getRangeAt(i));\n                        }\n                    }\n                    return \"[\" + name + \"(Ranges: \" + rangeInspects.join(\", \") + \")(anchor: \" + anchor.inspect() + \", focus: \" + focus.inspect() + \"]\";\n                }\n                selProto.getName = function() {\n                    return \"WrappedSelection\";\n                };\n                selProto.inspect = function() {\n                    return inspect(this);\n                };\n                selProto.detach = function() {\n                    actOnCachedSelection(this.win, \"delete\");\n                    deleteProperties(this);\n                };\n                WrappedSelection.detachAll = function() {\n                    actOnCachedSelection(null, \"deleteAll\");\n                };\n                WrappedSelection.inspect = inspect;\n                WrappedSelection.isDirectionBackward = isDirectionBackward;\n                api.Selection = WrappedSelection;\n                api.selectionPrototype = selProto;\n                api.addCreateMissingNativeApiListener(function(win) {\n                    if (typeof win.getSelection == \"undefined\") {\n                        win.getSelection = function() {\n                            return getSelection(win);\n                        };\n                    }\n                    win = null;\n                });\n            });\n        }, {\n            \"./core\": 11\n        } ]\n    }, {}, [ 10 ])(10);\n});"],"sourceRoot":"/source/"}